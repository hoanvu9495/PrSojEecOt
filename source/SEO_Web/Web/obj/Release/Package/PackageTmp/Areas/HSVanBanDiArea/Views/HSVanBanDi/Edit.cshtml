@using Web.Models;
@using Web.FwCore;
@using Model.eAita;
@using Web.Areas.HSVanBanDiArea.Models;
@using Web.Common;
@model VBDiCreateViewModel
@{
    ViewBag.Title = "Cập nhật Văn bản đi";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<WF_TRANGTHAI> lstSteps = new List<WF_TRANGTHAI>();
    lstSteps = (List<WF_TRANGTHAI>)SessionManager.GetValue("ListBuocChuyenTrangThaiVanBanDi");
    var list_coquantrongdonvi_id = "";
    var list_coquantrongdonvi_saved_id = "";
    var COSO_NHANVB_IDS = "";
}

<style>
    .nhieunguoiky {
        display: none;
    }

    #vb_di_tabs section {
        height: 100px;
    }

    #tab_thongtinchinh, #tab_quytrinhxuly {
        overflow: auto;
        height: 34em;
        padding-bottom: 20px;
    }

    #tab_noidungvanban {
        padding-bottom: 20px;
    }

    #tab_butphelanhdao {
        padding-bottom: 30px;
    }

    #tab_donvinhan_theodoi_vb {
        overflow: auto;
        height: 34em;
        padding-bottom: 20px;
    }

    .e-input {
        height: 30px;
    }

    #frmVanBanDiCreate label {
        font-weight: normal !important;
    }
</style>
<link href="/Content/Custom/css/multiple-select.css" rel="stylesheet" />
<script src="/Scripts/multiple-select.js"></script>
<div id="menu-toolbar" class="date-time">
    <div class="left-all-page">
        <div id="smart-dms" class="block">
            <h1>Smart DMS</h1>
        </div>
    </div>
    <div class="right-all-page" style="background:none; border:0px;">
        <div class="menu-left">
            <div class="btnAddNew" style="margin-right:10px;">
                <a href="/vanbandiarea/vanbandi/create">
                    <span>Văn bản đi Mới</span>
                </a>
            </div>
            <div class="btn-group" role="group" aria-label="...">
                <div class="btn-group" role="group">
                    <button type="button" class="b_btn b_btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Theo dõi văn bản
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        @*<li><a href="">Tạo hồ sơ</a></li>*@
                        <li><a href="/congviecarea/congviec/create?vbType=@LOAITAILIEU.VANBANDI&vbId=@Model.VanBanDi.ID">Tạo công việc</a></li>
                    </ul>
                </div>
                <div class="btn-group" role="group">
                    <button type="button" class="b_btn b_btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Tác vụ khác
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a href="/vanbandiarea/vanbandi/detail/@Model.VanBanDi.ID">Xem chi tiết</a></li>
                        <li><a href="">Xóa</a></li>
                        <li><a href="">Bỏ duyệt</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="left-all-page" id="menu-middle-left">
    <div class="left-content block" style="overflow-y: auto;">
        <ul class="admin-menu">
            <li class="menu" style="z-index:10">
                <a href="/VanBanDiArea/VanBanDi/Index">Tất cả Văn bản đi</a>
                <ul class="admin-menu-child">
                    <li>
                        <a href="/VanBanDiArea/VanBanDi/DanhSachVanBanToiDaKy">Văn bản đi tôi đã ký</a>
                    </li>
                    <li>
                        <a href="/VanBanDiArea/VanBanDi/DanhSachVanBanToiTheoDoi">Văn bản đi tôi theo dõi chính</a>
                    </li>
                    <li>
                        <a href="/VanBanDiArea/VanBanDi/DanhSachVanBanToiSoanThao">Văn bản đi tôi soạn thảo</a>
                    </li>
                    <li>
                        <a href="/VanBanDiArea/VanBanDi/DanhSachVanBanPhongToiTheoDoi">Văn bản đi phòng tôi theo dõi</a>
                    </li>
                    <li>
                        <a href="/VanBanDiArea/VanBanDi/DanhSachVanBanPhongToiSoanThao">Văn bản đi phòng tôi soạn thảo</a>
                    </li>
                </ul>
            </li>
            @if (lstSteps != null && lstSteps.Count > 0)
            {
                <li class="menu">
                    <a href="javascript:void(0)">Văn bản theo luồng xử lý</a>
                    <ul class="admin-menu-child">
                        @foreach (var item in lstSteps)
                        {
                            <li>
                                <div class="">
                                    <a href="/VanBanDiArea/VanBanDi/DanhSachVanBan/@item.ID">Văn bản đi @item.TENTRANGTHAI</a>
                                </div>
                            </li>
                        }
                        <li>
                            <div class="">
                                <a href="/VanBanDiArea/VanBanDi/DanhSachVanBanDangTrongLuong">Văn bản đi đang được xử lý</a>
                            </div>
                        </li>
                    </ul>
                </li>
            }
            <li class="menu has-child" style="z-index:10">
                <a href="/VanBanDenArea/VanBanDen/Index">Quản lý Văn bản đến</a>
            </li>
            <li class="menu has-child" style="z-index:10">
                <a href="/CongViecArea/CongViec/Index">Quản lý Công việc</a>
            </li>
            <li class="menu has-child">
                <a href="javascript:void(0)">Cấu hình</a>
                <ul class="">
                    <li class="menu">
                        <div class="">
                            <a href="/WorkFlowArea/WorkFlow/ChonLuongXuLy">Chọn luồng xử lý cho văn bản đi/đến</a>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</div>
<div class="right-all-page">
    <div class="right-content clearfix">
        <div class="hsContent">
            @using (Html.BeginForm("Edit", "VanBanDi", FormMethod.Post, new { enctype = "multipart/form-data", Id = "frmVanBanDiCreate" }))
            {
                @Html.AntiForgeryToken()
                @*<div class="hsBar">Cập nhật thông tin văn bản đi</div>*@
                <div id="vb_di_tabs" style="padding-bottom:10px;">
                    <h3>Thông tin chính <span style="color: red;">*</span></h3>
                    <section>
                        <div id="tab_thongtinchinh">
                            <table class="edit-table" style="width:95.5%">
                                @*Hàng 1*@
                                <tr>
                                    <td>
                                        <label class="lbl">Nhóm sổ văn bản:<span style="color: red;">*</span></label>
                                    </td>
                                    <td>
                                        <div class="input-field4 clearfix" style="width: 233px; margin-left:10px">
                                            @if (Model.ListNhomSoVanBan != null && Model.ListNhomSoVanBan.Count == 1)
                                            {
                                                @Html.DropDownList("NHOMSOVANBAN_ID", Model.ListNhomSoVanBan, new { @class = "create-phanloai", @style = "width: 100%" })
                                            }
                                            else
                                            {
                                                @Html.DropDownList("NHOMSOVANBAN_ID", new SelectList(Model.ListNhomSoVanBan, "Value", "Text", Model.VanBanDi.NHOMSOVANBAN_ID), "[--- Chọn nhóm sổ văn bản ---]", new { @class = "create-phanloai", @style = "width: 100%" })
                                            }
                                        </div>
                                    <td>
                                        <label class="lbl">Sổ văn bản:<span style="color: red;">*</span></label>
                                    </td>
                                    <td>
                                        <div class="input-field4 clearfix" style="width: 233px; margin-left:10px">
                                            <select name="SOVANBAN_ID" id="SOVANBAN_ID">
                                                <option value=''>[--- Chọn sổ văn bản ---]</option>
                                                @if (Model.ListSoVanBan != null && Model.ListSoVanBan.Count > 0)
                                                {
                                                    foreach (var item in Model.ListSoVanBan)
                                                    {
                                                        if (item.ID == Model.VanBanDi.SOVANBAN_ID)
                                                        {
                                                            <option data-sovb="@item.SOVBTHEOSO" value="@item.ID" selected="selected">@item.TENSO</option>
                                                        }
                                                        else
                                                        {
                                                            <option data-sovb="@item.SOVBTHEOSO" value="@item.ID">@item.TENSO</option>
                                                        }
                                                    }
                                                }
                                            </select>
                                        </div>
                                    </td>
                                    <td></td>
                                </tr>
                                <tr style="height: 15px;">
                                    <td></td>
                                    <td>
                                        <span class="lb-Check" id="NHOMSOVANBAN_ID_NULL">Bạn hãy chọn nhóm sổ văn bản</span>
                                    </td>
                                    <td></td>
                                    <td>
                                        <span class="lb-Check" id="SOVANBAN_ID_NULL">Bạn hãy chọn sổ văn bản</span>
                                    </td>
                                </tr>
                                @*Hàng 2*@
                                <tr>
                                    <td>
                                        <label class="lbl">Độ khẩn:</label>
                                    </td>
                                    <td>
                                        <div class="input-field4 clearfix" style="width: 233px; margin-left:10px">
                                            @Html.DropDownList("DOKHAN_ID", new SelectList(Model.ListDoKhanVanBan, "Value", "Text", Model.VanBanDi.DOKHAN_ID), new { @class = "create-phanloai", @style = "width: 100%" })
                                        </div>
                                    </td>
                                    <td>
                                        <label class="lbl">Mức độ quan trọng:</label>
                                    </td>
                                    <td>
                                        <div class="input-field4 clearfix" style="width: 233px; margin-left:10px">
                                            @Html.DropDownList("MUCDOQUANTRONG_ID", new SelectList(Model.ListMucDoQuanTrongVanBan, "Value", "Text", Model.VanBanDi.MUCDOQUANTRONG_ID), new { @class = "create-phanloai", @style = "width: 100%" })
                                        </div>
                                    </td>
                                    <td></td>
                                </tr>
                                <tr style="height: 15px;"></tr>
                                @*Hàng 3*@
                                <tr>
                                    <td>
                                        <label class="lbl">Loại văn bản:<span style="color: red;">*</span></label>
                                    </td>
                                    <td colspan="4">
                                        <div class="input-field4 clearfix" style="width: 233px; margin-left:10px">
                                            <select name="LOAIVANBAN_ID" id="LOAIVANBAN_ID">
                                                <option value=''>[--- Chọn loại văn bản ---]</option>
                                                @if (Model.ListLoaiVanBan != null && Model.ListLoaiVanBan.Count > 0)
                                                {
                                                    foreach (var item in Model.ListLoaiVanBan)
                                                    {
                                                        if (item.ID == Model.VanBanDi.LOAIVANBAN_ID)
                                                        {
                                                            <option value="@item.ID" data-id="@item.KYHIEU" selected="selected">@item.TENLOAIVANBAN    --- (@item.KYHIEU)</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@item.ID" data-id="@item.KYHIEU">@item.TENLOAIVANBAN    --- (@item.KYHIEU)</option>
                                                        }

                                                    }
                                                }
                                            </select>
                                        </div>
                                    </td>
                                </tr>
                                <tr style="height: 15px;">
                                    <td></td>
                                    <td>
                                        <span class="lb-Check" id="LOAIVANBAN_ID_NULL">Bạn hãy chọn loại văn bản</span>
                                    </td>
                                </tr>
                                @*Hàng 4*@
                                <tr>
                                    @*<td>
                                            <label class="lbl">Số đi tổng hợp:<span style="color: red;">*</span></label>
                                        </td>
                                        <td>
                                            @Html.TextBox("SODITONGHOP", "", new { @style = "width:223px; margin-left:10px; ", @placeholder = "", @class = "e-input", @maxlength = "10" })
                                        </td>*@
                                    <td>
                                        <label class="lbl">Số đi theo sổ:<span style="color: red;">*</span></label>
                                    </td>
                                    <td>
                                        @Html.TextBox("SODITHEOSO", Model.VanBanDi.SODITHEOSO, new { @style = "width:223px; margin-left:10px; ", @placeholder = "", @class = "e-input", @maxlength = "10" })
                                    </td>
                                    <td></td>
                                </tr>
                                <tr style="height: 15px;">
                                    @*<td></td>
                                        <td>
                                            <span class="lb-Check" id="SODITONGHOP_NULL">Bạn hãy nhập số đi tổng hợp</span>
                                        </td>*@
                                    <td></td>
                                    <td>
                                        <span class="lb-Check" id="SODITHEOSO_NULL">Bạn hãy nhập số đi theo sổ</span>
                                    </td>
                                </tr>
                                @*Hàng 5*@
                                <tr>
                                    <td>
                                        <label class="lbl">Số hiệu văn bản:<span style="color: red;">*</span></label>
                                    </td>
                                    <td colspan="4">
                                        @Html.TextBox("SOHIEU", Model.VanBanDi.SOHIEU, new { @style = "width:223px; margin-left:10px; ", @placeholder = "", @class = "e-input", @maxlength = "250" }) @*<a href="javascript:TaoSoHieu()" title="Click để tạo số hiệu văn bản tự động">Tạo số hiệu văn bản</a>*@
                                        <span style="margin-left:10px; font-style:italic;"><b>Ghi chú: </b>Số hiệu văn bản được tạo ra từ 3 thông tin (Số văn bản theo sổ, loại văn bản và đơn vị ban hành)</span>
                                    </td>
                                </tr>
                                <tr style="height: 15px;">
                                    <td></td>
                                    <td>
                                        <span class="lb-Check" id="SOHIEU_NULL">Bạn hãy nhập số hiệu văn bản</span>
                                    </td>
                                </tr>
                                @*Hàng 6*@
                                <tr>
                                    <td>
                                        <label class="lbl">Ngày ký:</label>
                                    </td>
                                    <td colspan="4">
                                        @Html.TextBox("NGAYKY", string.Format("{0:dd/MM/yyyy}", Model.VanBanDi.NGAYKY), new { @style = "width:223px; margin-left:10px; ", @placeholder = "", @class = "e-input datepicker", @maxlength = "10" }) (Ví dụ: 24/10/2010)
                                    </td>
                                </tr>
                                <tr style="height: 15px;">
                                    <td></td>
                                    <td>
                                        <span class="lb-Check" id="NGAYKY_FORMAT">Bạn hãy nhập đúng định dạng</span>
                                    </td>
                                </tr>
                                @*Hàng 7*@
                                <tr>
                                    <td>
                                        <label class="lbl">Người ký:</label>
                                    </td>
                                    <td>
                                        @Html.TextBox("NGUOIKYACCOUNT", Model.VanBanDi.TENNGUOIKY, new { @style = "width:150px; margin-left:10px; ", @placeholder = "", @class = "e-input", @maxlength = "250" })<a style="margin-left:5px;margin-right:10px;" href="javascript:void(0)" id="CHONNGUOIKY">Chọn</a>|<a style="margin-left:10px;" href="javascript:XoaNguoiKy(1)">Xóa</a>
                                        <input type="hidden" id="NGUOIKY" name="NGUOIKY" value="@Model.VanBanDi.NGUOIKY_ID" />
                                        @*<iframe id='NGUOIKYACCOUNT_iframe' frameborder='0' style='position:absolute;top:1px;left:1px;width:0px;height:0px;'></iframe>*@
                                    </td>
                                    <td>
                                        <label class="lbl">Chức vụ:</label>
                                    </td>
                                    <td>
                                        @Html.TextBox("CHUCVU", Model.VanBanDi.CHUCVUNGUOIKY, new { @style = "width:223px; margin-left:10px; ", @placeholder = "", @class = "e-input", @maxlength = "250" })
                                    </td>
                                    <td>
                                        <input onclick="ThemNguoiKy()" class="css-checkbox" id="CHK_NHIEUNGUOIKY" value="True" name="CHK_NHIEUNGUOIKY" type="checkbox">
                                        <label for="CHK_NHIEUNGUOIKY" class="css-label2">Hiển thị thêm người ký</label>
                                    </td>
                                </tr>
                                @*Hàng 7 - 1*@
                                @{var stt = 2; }
                                @if (Model.ListNguoiKyVanBan != null && Model.ListNguoiKyVanBan.Count > 0)
                                {
                                    foreach (var item in Model.ListNguoiKyVanBan)
                                    {
                                        <tr style="height: 15px;"></tr>
                                        <tr>
                                            <td>
                                                <label class="lbl">Người ký @stt:</label>
                                            </td>
                                            <td>
                                                @Html.TextBox("NGUOIKYACCOUNT" + stt, item.TENNGUOIKY, new { @style = "width:150px; margin-left:10px; ", @placeholder = "", @class = "e-input", @maxlength = "250" })<a style="margin-left:5px;margin-right:10px;" href="javascript:void(0)" id="CHONNGUOIKY@(stt)">Chọn</a>|<a style="margin-left:10px;" href="javascript:XoaNguoiKy(@stt)">Xóa</a>
                                                <input type="hidden" id="NGUOIKY@(stt)" name="NGUOIKY@(stt)" value="@item.USER_ID" />
                                            </td>
                                            <td>
                                                <label class="lbl">Chức vụ:</label>
                                            </td>
                                            <td>
                                                @Html.TextBox("CHUCVU" + stt, item.CHUCVU, new { @style = "width:223px; margin-left:10px; ", @placeholder = "", @class = "e-input", @maxlength = "250" })
                                            </td>
                                            <td></td>
                                        </tr>
                                        stt++;
                                    }
                                }
                                @for (int i = stt; i < 4; i++)
                                {
                                    <tr class="nhieunguoiky" style="height: 15px;"></tr>
                                    <tr class="nhieunguoiky">
                                        <td>
                                            <label class="lbl">Người ký @i:</label>
                                        </td>
                                        <td>
                                            @Html.TextBox("NGUOIKYACCOUNT" + i, "", new { @style = "width:150px; margin-left:10px; ", @placeholder = "", @class = "e-input", @maxlength = "250" })<a style="margin-left:5px;margin-right:10px;" href="javascript:void(0)" id="CHONNGUOIKY@(i)">Chọn</a>|<a style="margin-left:10px;" href="javascript:XoaNguoiKy(@i)">Xóa</a>
                                            <input type="hidden" id="NGUOIKY@(i)" name="NGUOIKY@(i)" value="" />
                                        </td>
                                        <td>
                                            <label class="lbl">Chức vụ:</label>
                                        </td>
                                        <td>
                                            @Html.TextBox("CHUCVU" + i, "", new { @style = "width:223px; margin-left:10px; ", @placeholder = "", @class = "e-input", @maxlength = "250" })
                                        </td>
                                        <td></td>
                                    </tr>
                                }
                                <tr style="height: 15px;"></tr>
                                @*Hàng 8*@
                                <tr>
                                    <td>
                                        <label class="lbl">Ngày ban hành:</label>
                                    </td>
                                    <td>
                                        @Html.TextBox("NGAYBANHANH", string.Format("{0:dd/MM/yyyy}", Model.VanBanDi.NGAYBANHANH), new { @style = "width:150px; margin-left:10px; ", @placeholder = "", @class = "e-input datepicker", @maxlength = "10" }) (Ví dụ: 24/11/2010)
                                    </td>
                                    <td>
                                        <label class="lbl">Đơn vị ban hành:</label>
                                    </td>
                                    <td>
                                        <div class="input-field4 clearfix" style="width: 233px; margin-left:10px">
                                            <select name="DONVIBANHANH_ID" id="DONVIBANHANH_ID">
                                                <option value=''>[--- Chọn đơn vị ban hành ---]</option>
                                                @if (Model.ListDonViBanHanh != null && Model.ListDonViBanHanh.Count > 0)
                                                {
                                                    foreach (var item in Model.ListDonViBanHanh)
                                                    {
                                                        if (item.ID == Model.VanBanDi.DONVIBANHANH_ID)
                                                        {
                                                            <option data-madv="@item.MADONVI" value="@item.ID" selected="selected">@item.TENDONVI</option>
                                                        }
                                                        else
                                                        {
                                                            <option data-madv="@item.MADONVI" value="@item.ID">@item.TENDONVI</option>
                                                        }
                                                    }
                                                }
                                            </select>
                                        </div>
                                    </td>
                                </tr>
                                <tr style="height: 15px;">
                                    <td></td>
                                    <td>
                                        <span class="lb-Check" id="NGAYBANHANH_FORMAT">Bạn hãy nhập đúng định dạng</span>
                                    </td>
                                </tr>
                                @*Hàng 9*@
                                <tr>
                                    <td>
                                        <label class="lbl">Trích yếu:<span style="color: red;">*</span></label>
                                    </td>
                                    <td colspan="4">
                                        @Html.TextArea("TRICHYEU", Model.VanBanDi.TRICHYEU, new { @style = "width:720px;height:40px; margin-left:10px;font-size:13px;", @placeholder = "", @class = "e-input", @maxlength = "500" })
                                    </td>
                                </tr>
                                <tr style="height: 15px;">
                                    <td></td>
                                    <td colspan="4">
                                        <span class="lb-Check" id="TRICHYEU_NULL">Bạn hãy nhập trích yếu của văn bản</span>
                                    </td>
                                </tr>
                                @*Hàng 10*@
                                <tr>
                                    <td>
                                        <label class="lbl">Tài liệu đính kèm:</label>
                                    </td>
                                    <td colspan="3">
                                        <div style="margin-left:10px;">
                                            @{Html.RenderPartial("../Common/UploadFile", Model.ListTaiLieuDinhKem);}
                                        </div>
                                    </td>
                                </tr>
                                <tr style="height: 15px;"></tr>
                                @*Hàng 11*@
                                <tr>
                                    <td>
                                        <label class="lbl">Số bản sao:</label>
                                    </td>
                                    <td colspan="2">
                                        @Html.TextBox("SOBANSAO", Model.VanBanDi.SOBANSAO, new { @style = "width:100px; margin-left:10px;", @placeholder = "", @class = "e-input", @maxlength = "3" })
                                        Số tờ:
                                        @Html.TextBox("SOTO", Model.VanBanDi.SOTO, new { @style = "width:100px; margin-left:10px;", @placeholder = "", @class = "e-input", @maxlength = "3" })
                                    </td>
                                </tr>
                                <tr style="height: 15px;">
                                    <td></td>
                                    <td>
                                        <span class="lb-Check" id="SOBANSAO_FORMAT">Nhập định dạng số</span>
                                        <span class="lb-Check" id="SOTO_FORMAT">Nhập định dạng số</span>
                                    </td>
                                </tr>
                                @*Hàng 12*@
                                <tr>
                                    <td>
                                        <label class="lbl">Ngày có hiệu lực:</label>
                                    </td>
                                    <td>
                                        @Html.TextBox("NGAYCOHIEULUC", string.Format("{0:dd/MM/yyyy}", Model.VanBanDi.NGAYCOHIEULUC), new { @style = "width:150px; margin-left:10px; ", @placeholder = "", @class = "e-input datepicker", @maxlength = "10" })
                                    </td>
                                    <td>
                                        <label class="lbl">Ngày hết hiệu lực:</label>
                                    </td>
                                    <td colspan="2">
                                        @Html.TextBox("NGAYHETHIEULUC", string.Format("{0:dd/MM/yyyy}", Model.VanBanDi.NGAYHETHIEULUC), new { @style = "width:150px; margin-left:10px; ", @placeholder = "", @class = "e-input datepicker", @maxlength = "10" }) (Ví dụ: 24/11/2020)
                                    </td>
                                </tr>
                                <tr style="height: 15px;">
                                    <td></td>
                                    <td>
                                        <span class="lb-Check" id="NGAYCOHIEULUC_FORMAT">Bạn hãy nhập đúng định dạng</span>
                                    </td>
                                    <td></td>
                                    <td colspan="2">
                                        <span class="lb-Check" id="NGAYHETHIEULUC_FORMAT">Bạn hãy nhập đúng định dạng</span>
                                    </td>
                                </tr>                            @*Hàng 13*@
                                <tr>
                                    <td>
                                        <label class="lbl">Người soạn thảo:<span style="color: red;">*</span></label>
                                    </td>
                                    <td>
                                        @Html.TextBox("NGUOISOAN", Model.VanBanDi.NGUOISOAN, new { @style = "width:150px; margin-left:10px; ", @placeholder = "", @class = "e-input", @maxlength = "250" })<a style="margin-left:5px;margin-right:10px;" href="javascript:void(0)" id="CHONNGUOISOAN">Chọn</a>|<a style="margin-left:10px;" href="javascript:XoaNguoiSoan()">Xóa</a>
                                        <input type="hidden" id="NGUOISOAN_ID" name="NGUOISOAN_ID" value="@Model.VanBanDi.NGUOISOAN_ID" />
                                    </td>
                                    <td>
                                        <label class="lbl">Đơn vị soạn thảo:<span style="color: red;">*</span></label>
                                    </td>
                                    <td colspan="2">
                                        @*@Html.TextBox("DONVISOAN", "", new { @style = "width:250px; margin-left:10px; ", @placeholder = "", @class = "e-input", @maxlength = "250" })<a style="margin-left:5px;margin-right:10px;" href="javascript:void(0)" id="CHONDONVISOAN">Chọn</a>|<a style="margin-left:10px;" href="javascript:XoaDonViSoan()">Xóa</a>
                                            <input type="hidden" id="DONVISOAN_ID" name="DONVISOAN_ID" value="" />*@
                                        <div class="input-field4 clearfix" style="width: 233px; margin-left:10px">
                                            @Html.DropDownList("DONVISOANTHAO_ID", new SelectList(Model.ListDonViTrongCoQuan, "Value", "Text", Model.VanBanDi.DONVISOANTHAO_ID), "[---Chọn đơn vị soạn thảo---]", new { @class = "create-phanloai", @style = "width: 100%" })
                                        </div>
                                    </td>
                                </tr>
                                <tr style="height: 15px;">
                                    <td></td>
                                    <td>
                                        <span class="lb-Check" id="NGUOISOAN_NULL">Bạn hãy chọn người soạn văn bản</span>
                                    </td>
                                    <td></td>
                                    <td>
                                        <span class="lb-Check" id="DONVISOAN_ID_NULL">Bạn hãy chọn đơn vị soạn văn bản</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label class="lbl">Văn bản liên quan:</label>
                                    </td>
                                    <td>
                                        @{ Html.RenderPartial("../Common/_VanBanLienQuan", Model.ListVanBanLienQuan, new ViewDataDictionary { { "vbdi", 1 } });}
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </section>
                    <h3>Thông tin khác</h3>
                    <section>
                        <div id="tab_thongtinkhac">
                            <table class="edit-table" style="width:95.5%">
                                @*Hàng 1*@
                                <tr>
                                    <td>
                                        <label class="lbl">Nhận văn bản:</label>
                                    </td>
                                    <td>
                                        <div class="input-field4 clearfix" style="width: 233px; margin-left:10px">
                                            <select name="HINHTHUCTIEPNHAN" id="HINHTHUCTIEPNHAN">
                                                <option value='2'>Để biết</option>
                                                <option value='1'>Để xử lý</option>
                                            </select>
                                        </div>
                                    </td>
                                    <td>
                                        <label class="lbl">Số trả lời:</label>
                                    </td>
                                    <td>
                                        @Html.TextBox("SOTRALOI", Model.VanBanDi.SOTRALOI, new { @style = "width:250px; margin-left:10px; ", @placeholder = "", @class = "e-input", @maxlength = "250" })
                                    </td>
                                    <td></td>
                                </tr>
                                <tr style="height: 15px;"></tr>
                                @*Hàng 2*@
                                <tr>
                                    <td>
                                        <label class="lbl">Lĩnh vực:</label>
                                    </td>
                                    <td>
                                        <div class="input-field4 clearfix" style="width: 233px; margin-left:10px">
                                            @Html.DropDownList("LINHVUC_ID", new SelectList(Model.ListLinhVucVanBan, "Value", "Text", Model.VanBanDi.LINHVUCVANBAN_ID), "[--- Chọn lĩnh vực ---]", new { @class = "create-phanloai", @style = "width: 100%" })
                                        </div>
                                    </td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr style="height: 15px;"></tr>
                                @*Hàng 3*@
                                @*<tr>
                                        <td>
                                            <label class="lbl">Nơi lưu trữ:</label>
                                        </td>
                                        <td>
                                            <div class="input-field4 clearfix" style="width: 233px; margin-left:10px">
                                                @Html.DropDownList("THUMUC_ID", Model.ListLinhVucVanBan, "[--- Chọn nơi lưu trữ ---]", new { @class = "create-phanloai", @style = "width: 100%" })
                                            </div>
                                        </td>
                                        <td colspan="3">
                                            @Html.TextBox("NOILUUTRU", "", new { @style = "width:365px; margin-left:10px;", @placeholder = "Nơi lưu trữ khác", @class = "e-input", @maxlength = "500" })
                                        </td>
                                    </tr>
                                    <tr style="height: 15px;"></tr>*@
                                @*Hàng 4*@
                                <tr>
                                    <td>
                                        <label class="lbl">Thông tin liên quan công việc:</label>
                                    </td>
                                    <td colspan="4">
                                        @Html.TextArea("DIEUKHOANLIENQUANCONGVIEC", Model.VanBanDi.DIEUKHOANLIENQUANCONGVIEC, new { @style = "width:700px;height:40px; margin-left:10px;", @placeholder = "", @class = "e-input", @maxlength = "500" })
                                    </td>
                                </tr>
                                <tr style="height: 15px;"></tr>
                                @*Hàng 5*@
                                <tr>
                                    <td>
                                        <label class="lbl">Ghi chú:</label>
                                    </td>
                                    <td colspan="4">
                                        @Html.TextArea("GHICHU", Model.VanBanDi.GHICHU, new { @style = "width:700px;height:40px; margin-left:10px;", @placeholder = "", @class = "e-input", @maxlength = "500" })
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </section>
                    <h3>Nội dung văn bản</h3>
                    <section>
                        <div id="tab_noidungvanban">
                            <table class="edit-table" style="width:95.5%">
                                @*Hàng 1*@
                                <tr>
                                    <td>
                                        <label class="lbl">Nội dung văn bản:</label>
                                    </td>
                                    <td colspan="4">
                                        @Html.TextArea("NOIDUNGVANBAN", Model.VanBanDi.NOIDUNGVANBAN, new { @style = "width:800px;height:300px; margin-left:10px;", @placeholder = "", @class = "e-input", @maxlength = "500" })
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </section>
                    <h3>Bút phê lãnh đạo</h3>
                    <section>
                        <div id="tab_butphelanhdao">
                            <table class="edit-table" style="width:95.5%">
                                @*Hàng 1*@
                                <tr>
                                    <td>
                                        <label class="lbl">Lãnh đạo bút phê:</label>
                                    </td>
                                    <td colspan="4">
                                        @Html.TextBox("LANHDAOBUTPHE", "", new { @style = "width:250px;", @placeholder = "", @class = "e-input", @maxlength = "250" })<a style="margin-left:5px;margin-right:10px;" href="javascript:void(0)" id="CHONLANHDAO">Chọn</a>|<a style="margin-left:10px;" href="javascript:XoaLanhDao()">Xóa</a>
                                        <input type="hidden" id="LANHDAO_ID" name="LANHDAO_ID" value="" />
                                    </td>
                                </tr>
                                <tr style="height: 15px;"></tr>
                                @*Hàng 2*@
                                <tr>
                                    <td>
                                        <label class="lbl">Ý kiến chỉ đạo:</label>
                                    </td>
                                    <td colspan="4">
                                        @Html.TextArea("YKIENCHIDAO", "", new { @style = "width:600px;height:200px; margin-left:10px;", @placeholder = "", @class = "e-input", @maxlength = "500" })
                                    </td>
                                </tr>
                                <tr style="height: 15px;"></tr>
                                @*Hàng 3*@
                                <tr>
                                    <td>
                                        <label class="lbl">Tính chất:</label>
                                    </td>
                                    <td colspan="4">
                                        <input class="css-checkbox" id="CHK_IS_QUANTRONG" value="True" name="CHK_IS_QUANTRONG" type="checkbox">
                                        <label for="CHK_IS_QUANTRONG" class="css-label2">Quan trọng</label>
                                    </td>
                                </tr>
                                <tr style="height: 15px;"></tr>
                                @*Hàng 4*@
                                <tr>
                                    <td>
                                        <label class="lbl">Thông báo:</label>
                                    </td>
                                    <td colspan="4">
                                        <input class="css-checkbox" id="CHK_HAS_THONGBAOVANTHU" value="True" name="CHK_HAS_THONGBAOVANTHU" type="checkbox">
                                        <label for="CHK_HAS_THONGBAOVANTHU" class="css-label2">Gửi cho Văn thư</label>
                                    </td>
                                </tr>
                                <tr style="height: 25px;"></tr>
                            </table>
                        </div>
                    </section>
                    <h3>Đơn vị nhận, theo dõi văn bản</h3>
                    <section>
                        <div id="tab_donvinhan_theodoi_vb">
                            <table class="edit-table" style="width:95.5%">
                                @*Hàng 1*@
                                <tr>
                                    <td colspan="5">
                                        <h3 class="group-tittle" style="margin-bottom:10px;text-transform:none;">
                                            01. Đơn vị theo dõi văn bản
                                        </h3>
                                    </td>
                                </tr>
                                <tr>
                                    <td width="200px">
                                        <label class="lbl">Đơn vị theo dõi chính:</label>
                                    </td>
                                    <td colspan="4">
                                        <div class="input-field4 clearfix" style="width: 233px;">
                                            @Html.DropDownList("DONVITHEODOICHINH_ID", new SelectList(Model.ListDonViTrongCoQuan, "Value", "Text", Model.VanBanDi.DONVITHEODOICHINH_ID), "[---Chọn đơn vị theo dõi chính---]", new { @class = "create-phanloai", @style = "width: 100%" })
                                        </div>
                                    </td>
                                </tr>
                                <tr style="height: 15px;"></tr>
                                @*Hàng 2*@
                                <tr>
                                    <td>
                                        <label class="lbl">Người theo dõi chính:</label>
                                    </td>
                                    <td colspan="4">
                                        @Html.TextBox("NGUOITHEODOICHINH", Model.VanBanDi.TENNGUOITHEODOICHINH, new { @style = "width:350px;", @placeholder = "", @class = "e-input", @maxlength = "250" })<a style="margin-left:5px;margin-right:10px;" href="javascript:void(0)" id="CHONNGUOITHEODOICHINH">Chọn</a>|<a style="margin-left:10px;" href="javascript:XoaNguoiTheoDoiChinh()">Xóa</a>
                                        <input type="hidden" id="NGUOITHEODOICHINH_ID" name="NGUOITHEODOICHINH_ID" value="@Model.VanBanDi.NGUOITHEODOICHINH_ID" />
                                    </td>
                                </tr>
                                <tr style="height: 15px;"></tr>
                                @*Hàng 3*@
                                <tr>
                                    <td colspan="5">
                                        <h3 class="group-tittle" style="margin-bottom:10px;text-transform:none;">
                                            02. Đơn vị nhận văn bản trong cơ quan@*@ViewBag.TenCoSo*@
                                        </h3>
                                        <table class="edit-table" style="width:95.5%">
                                            <tr>
                                                <td colspan="5">
                                                    @if (Model.ListDonViTrongCoQuan != null && Model.ListDonViTrongCoQuan.Count > 0)
                                                    {
                                                        <div style="float:left; width:100%;padding-left:20px">
                                                            <input class="css-checkbox" id="CHK_DVTRONGCQ_TATCA" name="CHK_DVTRONGCQ_TATCA" type="checkbox">
                                                            <label for="CHK_DVTRONGCQ_TATCA" class="css-label2"><b>Tất cả</b></label>
                                                        </div>
                                                        foreach (var item in Model.ListDonViTrongCoQuan)
                                                        {
                                                            list_coquantrongdonvi_id += item.Value + ",";
                                                            if (Model.ListDonViNhanTrongCoQuan != null && Model.ListDonViNhanTrongCoQuan.Contains(int.Parse(item.Value)))
                                                            {
                                                                list_coquantrongdonvi_saved_id += item.Value + ",";
                                                            }
                                                            <div style="float:left; width:45%;margin-left:2%">
                                                                @*<input class="css-checkbox" id="CHK_IS_XULYCHINH_@item.Value" value="@item.Value" name="CHK_IS_XULYCHINH" type="radio">
                                                                    <label style="width:auto;margin-top: 3px;color:rgb(17, 138, 203); text-transform:none;" for="CHK_IS_XULYCHINH_@item.Value" class="css-label"></label>*@
                                                                <input class="css-checkbox" id="CHK_DVTRONGCQ_@item.Value" value="@item.Value" name="CHK_DVTRONGCQ" type="checkbox" @(Model.ListDonViNhanTrongCoQuan != null && Model.ListDonViNhanTrongCoQuan.Contains(int.Parse(item.Value)) ? "checked='checked'" : "")>
                                                                <label style="width:auto;" for="CHK_DVTRONGCQ_@item.Value" class="css-label2">@item.Text</label>
                                                            </div>
                                                        }
                                                    }
                                                    <input type="hidden" name="list_coquantrongdonvi_id" id="list_coquantrongdonvi_id" value="@list_coquantrongdonvi_id" />
                                                    <input type="hidden" name="list_coquantrongdonvi_saved_id" id="list_coquantrongdonvi_saved_id" value="@list_coquantrongdonvi_saved_id" />
                                                    <input type="hidden" name="list_coquantrongdonvi" id="list_coquantrongdonvi" value="" />
                                                    @*<p style="font-style:italic;float: left;width: 100%;margin-top: 10px;color: red;">Chọn nút tròn nếu là đơn vị nhận chính, nếu không thì không chọn nút tròn!</p>*@
                                                </td>
                                            </tr>
                                        </table>

                                    </td>
                                </tr>
                                <tr style="height: 15px;"></tr>
                                @*Hàng 4*@
                                <tr>
                                    <td colspan="5">
                                        <h3 class="group-tittle" style="margin-bottom:10px;text-transform:none;">
                                            03. Cơ quan nhận văn bản trong cùng hệ thống
                                        </h3>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="5">
                                        <div style="float:left;width:55%;">
                                            <table class="edit-table" style="width:100%">
                                                <tr>
                                                    <td>
                                                        <label class="lbl">Cấp cơ sở:</label>
                                                    </td>
                                                    <td colspan="4">
                                                        <div class="input-field4 clearfix" style="width: 233px;">
                                                            <select name="CAPCOSO_ID" id="CAPCOSO_ID" onchange="LoadCoSo()">
                                                                <option value=''>[--- Cấp cơ sở ---]</option>
                                                                @if (Model.ListCapCoSo != null && Model.ListCapCoSo.Count > 0)
                                                                {
                                                                    foreach (var item in Model.ListCapCoSo)
                                                                    {
                                                                        <option value="@item.ID">@item.CAPCOSO</option>
                                                                    }
                                                                }
                                                            </select>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr style="height: 15px;"></tr>
                                            </table>
                                            <div style="float:left;width:100%;">
                                                <div id="List_CoSo_NhanVB" style="float: left;width: 80%;padding: 15px;border: 1px #ccc solid;max-height:250px; overflow:auto;">
                                                </div>
                                                <a href="javascript:ChonCoSoNhanVanBan();" title="Chọn Cơ sở nhận văn bản">
                                                    <img src="~/Content/Images/right.png" style="margin-left:30px;" />
                                                </a>
                                            </div>
                                        </div>
                                        <div style="float:left;width:45%;">
                                            <h3 class="group-tittle" style="color:#F88C01;margin-bottom:10px;text-transform:none;padding-top: 0px;padding-bottom: 2px;">
                                                Cơ quan nhận văn bản
                                            </h3>
                                            <ul id="List_CoSo_NhanVB_DaChon" style="float: left;width: 100%;padding: 15px;border: 1px #ccc solid;max-height:250px; overflow:auto;">

                                                @if (Model.ListCoQuanNhanTrongHeThong != null && Model.ListCoQuanNhanTrongHeThong.Count > 0)
                                                {
                                                    foreach (var item in Model.ListCoQuanNhanTrongHeThong)
                                                    {
                                                        COSO_NHANVB_IDS += item.COSO_ID + ",";
                                                        <li id="li_s_@item.COSO_ID">- <span>@item.TENCOSO</span><img data-id="@item.COSO_ID" id="img_@item.COSO_ID" class="delete_coso" onclick="javascript:XoaCoSoDaChon(@item.COSO_ID)" data-cap-id="@item.CAPCOSO_ID" style="cursor:pointer;margin-left:15px;" title="Bỏ cơ sở này" src="/Content/Images/Delete.png"></li>
                                                    }
                                                }
                                            </ul>
                                            <input type="hidden" value="@COSO_NHANVB_IDS" id="COSO_NHANVB_IDS" name="COSO_NHANVB_IDS" />
                                        </div>
                                    </td>
                                </tr>
                                @*Hàng 5*@
                                <tr>
                                    <td colspan="5">
                                        <h3 class="group-tittle" style="margin-bottom:10px;text-transform:none;">
                                            04. Đơn vị nhận văn bản ngoài hệ thống
                                        </h3>
                                        <table class="edit-table" style="width:95.5%">
                                            @*<tr>
                                                    <td>
                                                        <label class="lbl">Đơn vị nhận:</label>
                                                    </td>
                                                    <td colspan="4">
                                                        <div class="input-field4 clearfix" style="width: 233px;">
                                                            <select name="DONVINHAN_NGOAICOQUAN_ID" id="DONVINHAN_NGOAICOQUAN_ID" multiple>
                                                                <option value=''>[--- Chọn đơn vị ban hành ---]</option>
                                                                @if (Model.ListDonViBanHanh != null && Model.ListDonViBanHanh.Count > 0)
                                                                {
                                                                    foreach (var item in Model.ListDonViBanHanh)
                                                                    {
                                                                        <option value="@item.ID">@item.TENDONVI</option>
                                                                    }
                                                                }
                                                            </select>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr style="height: 15px;"></tr>*@
                                            <tr>
                                                <td>
                                                    <label class="lbl">Đơn vị:</label>
                                                </td>
                                                <td colspan="4">
                                                    @Html.TextArea("COQUANNGOAI_KHAC", Model.VanBanDi.COQUANNGOAI_KHAC, new { @style = "width:750px;height:40px;", @placeholder = "", @class = "e-input", @maxlength = "500" })
                                                </td>
                                            </tr>
                                        </table>

                                    </td>
                                </tr>
                            </table>
                        </div>
                    </section>
                </div>
                <div style="text-align: center; margin-top:10px;">
                    @if (Model.Allow_Update)
                    {
                        <input type="button" value="Lưu văn bản" id="btnSave" style="background-color: #336699; height: 25px; border: none; width: 100px; color: white;" />
                    }
                    <input type="button" value="Hủy bỏ" onclick="OnClose()" style="background-color: #336699; height: 25px; border: none; width: 100px; color: white;" />
                </div>
            }
        </div>
    </div>
</div>


@*<script src="~/Scripts/common_custom.js"></script>
    <script src="~/Scripts/autocomplete_custom.js"></script>*@
<script type="text/javascript">
    //var userarray = ["admin_cuc, Lãnh đạo", "namdv, Đặng Văn Nam", "duynt, Nguyễn Trọng Duy", "tulq, Lê Quang Tú"];
    //var usernamearray = ["admin_cuc", "namdv", "duynt", "tulq"];
    //$("#DONVIBANHANH_ID").multipleSelect({
    //    single: true,
    //    filter: true,
    //});
    $(document).ready(function () {

        //$("#NGUOIKYACCOUNT").keypress(function () {
        //    autocompleteuser(document.getElementById('NGUOIKYACCOUNT'), userarray, usernamearray, null, null, document.getElementById('NGUOIKYACCOUNT_iframe'));
        //});
        $("#vb_di_tabs").steps({
            headerTag: "h3",
            bodyTag: "section",
            transitionEffect: "slideLeft",
            enableFinishButton: false,
            enablePagination: true,
            enableAllSteps: true,
            titleTemplate: "#title#",
            cssClass: "tabcontrol"
        });
        if ($("#list_coquantrongdonvi_id").val() == $("#list_coquantrongdonvi_saved_id").val()) {
            $("#CHK_DVTRONGCQ_TATCA").prop("checked", "checked");
            $("#CHK_DVTRONGCQ_TATCA").prop("indeterminate", false);
        }
        else if ($("#list_coquantrongdonvi_saved_id").val().length > 0) {
            $("#CHK_DVTRONGCQ_TATCA").prop("checked", "");
            $("#CHK_DVTRONGCQ_TATCA").prop("indeterminate", true);
        }
        $("#LOAIVANBAN_ID").multipleSelect({
            single: true,
            filter: true,
        });
        $("#DONVIBANHANH_ID").multipleSelect({
            single: true,
            filter: true,
        });
        $("#DONVITHEODOICHINH_ID").multipleSelect({
            single: true,
            filter: true,
        });
        $(".datepicker").datepicker({ dateFormat: 'dd/mm/yy', changeMonth: true, changeYear: true, yearRange: "-50:+20" });

        tinymce.init({
            selector: '#NOIDUNGVANBAN',
            language: 'vi_VN',
            width: '100%',
            height: 280,
            plugins: [
                    "advlist autolink autosave link image lists charmap print preview hr anchor pagebreak spellchecker",
                    "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking",
                    "table contextmenu directionality emoticons template textcolor paste textcolor colorpicker textpattern"
            ],
            toolbar1: "bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | styleselect formatselect fontselect fontsizeselect",
            toolbar2: "cut copy paste pastetext | bullist numlist | outdent indent | undo redo | link unlink code | forecolor backcolor",
            toolbar3: "table | hr removeformat | subscript superscript | charmap emoticons | insertdatetime preview | print fullscreen | ltr rtl | pagebreak restoredraft",
            menubar: false,
            convert_urls: false,
            paste_data_images: true,
            toolbar_items_size: 'small'
        });
        tinymce.init({
            selector: '#YKIENCHIDAO',
            language: 'vi_VN',
            width: '100%',
            height: 180,
            plugins: [
                    "advlist autolink autosave link image lists charmap print preview hr anchor pagebreak spellchecker",
                    "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking",
                    "table contextmenu directionality emoticons template textcolor paste textcolor colorpicker textpattern"
            ],
            toolbar1: "bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | styleselect formatselect fontselect fontsizeselect",
            toolbar2: "cut copy paste pastetext | bullist numlist | outdent indent | undo redo | link unlink code | forecolor backcolor",
            toolbar3: "table | hr removeformat | subscript superscript | charmap emoticons | insertdatetime preview | print fullscreen | ltr rtl | pagebreak restoredraft",
            menubar: false,
            convert_urls: false,
            paste_data_images: true,
            toolbar_items_size: 'small'
        });

        $("input[name=CHK_DVTRONGCQ]").change(function () {
            var listChecked = "";
            $("input[name=CHK_DVTRONGCQ]:checked").each(function () {
                listChecked += $(this).val() + ",";
            });
            $("#list_coquantrongdonvi").val(listChecked);
            if (listChecked.length > 0) {
                if (listChecked == $("#list_coquantrongdonvi_id").val()) {
                    $("#CHK_DVTRONGCQ_TATCA").prop("checked", "checked");
                    $("#CHK_DVTRONGCQ_TATCA").prop("indeterminate", false);
                }
                else {
                    $("#CHK_DVTRONGCQ_TATCA").prop("checked", "");
                    $("#CHK_DVTRONGCQ_TATCA").prop("indeterminate", true);
                }
            }
            else {
                $("#CHK_DVTRONGCQ_TATCA").prop("checked", "");
                $("#CHK_DVTRONGCQ_TATCA").prop("indeterminate", false);
            }
        });
        $("input[name=CHK_DVTRONGCQ_TATCA]").change(function () {
            if ($(this).is(":checked")) {
                $("input[name=CHK_DVTRONGCQ]").prop("checked", "checked");
                $("#list_coquantrongdonvi").val($("#list_coquantrongdonvi_id").val());
            } else {
                $("input[name=CHK_DVTRONGCQ]").prop("checked", "");
                $("#list_coquantrongdonvi").val("");
            }
        });
        $('#cssmenu li.active').addClass('open').children('ul').show();
        $('#cssmenu li.has-sub>a').on('click', function () {
            $(this).removeAttr('href');
            var element = $(this).parent('li');
            if (element.hasClass('open')) {
                element.removeClass('open');
                element.find('li').removeClass('open');
                element.find('ul').slideUp(200);
            }
            else {
                element.addClass('open');
                element.children('ul').slideDown(200);
                element.siblings('li').children('ul').slideUp(200);
                element.siblings('li').removeClass('open');
                element.siblings('li').find('li').removeClass('open');
                element.siblings('li').find('ul').slideUp(200);
            }
        });
        $("#NHOMSOVANBAN_ID").change(function () {
            var id = $("#NHOMSOVANBAN_ID").val();
            if (id.length > 0 && parseInt(id) > 0) {
                $.ajax({
                    url: "/VanBanDiArea/VanBanDi/GetListSoVanBanByNhomSo",
                    type: 'POST',
                    data: { id: id },
                    success: function (data) {
                        $('#SOVANBAN_ID').html(data);
                    },
                    error: function (data) {
                        $('#SOVANBAN_ID').html("<option value=''>[--- Chọn sổ văn bản ---]</option>");
                    }
                });
                $("#NHOMSOVANBAN_ID_NULL").hide();
            }
            else {
                $('#SOVANBAN_ID').html("<option value=''>[--- Chọn sổ văn bản ---]</option>");
                $("#NHOMSOVANBAN_ID_NULL").show();
            }

        });
        $("#SOVANBAN_ID").change(function () {
            var item = $("#SOVANBAN_ID").val().trim().length;
            if (item <= 0) {
                $("#SOVANBAN_ID_NULL").show();
            }
            else {
                $("#SOVANBAN_ID_NULL").hide();
                var sovanban = $("#SOVANBAN_ID option:selected").attr("data-sovb");
                $("#SODITHEOSO").val(parseInt(sovanban) + 1);
            }
            TaoSoHieu();
        });
        $("#LOAIVANBAN_ID").change(function () {
            var item = $("#LOAIVANBAN_ID").val().trim().length;
            if (item <= 0) {
                $("#LOAIVANBAN_ID_NULL").show();
            }
            else {
                $("#LOAIVANBAN_ID_NULL").hide();
            }
            TaoSoHieu();
        });
        //$("#SODITONGHOP").keyup(function () {
        //    var item = $("#SODITONGHOP").val().trim().length;
        //    if (item <= 0) {
        //        $("#SODITONGHOP_NULL").show();
        //    }
        //    else { $("#SODITONGHOP_NULL").hide(); }
        //});
        $("#SODITHEOSO").keyup(function () {
            var item = $("#SODITHEOSO").val().trim().length;
            if (item <= 0) {
                $("#SODITHEOSO_NULL").show();
            }
            else { $("#SODITHEOSO_NULL").hide(); }
        });
        //SOHIEU
        $("#SOHIEU").keyup(function () {
            var item = $("#SOHIEU").val().trim().length;
            if (item <= 0) {
                $("#SOHIEU_NULL").show();
            }
            else { $("#SOHIEU_NULL").hide(); }
        });
        //NGAYKY
        $("#NGAYKY").focusout(function () {
            if ($("#NGAYKY").val().trim().length > 0) {
                if (checkDateTime($("#NGAYKY").val()) == false) {
                    $("#NGAYKY_FORMAT").show();
                } else {
                    $("#NGAYKY_FORMAT").hide();
                }
            }
        });

        //NGAYBANHANH
        $("#NGAYBANHANH").focusout(function () {
            if ($("#NGAYBANHANH").val().trim().length > 0) {
                if (checkDateTime($("#NGAYBANHANH").val()) == false) {
                    $("#NGAYBANHANH_FORMAT").show();
                } else {
                    $("#NGAYBANHANH_FORMAT").hide();
                }
            }
        });
        //NGAYCOHIEULUC
        $("#NGAYCOHIEULUC").focusout(function () {
            if ($("#NGAYCOHIEULUC").val().trim().length > 0) {
                if (checkDateTime($("#NGAYCOHIEULUC").val()) == false) {
                    $("#NGAYCOHIEULUC_FORMAT").show();
                } else {
                    $("#NGAYCOHIEULUC_FORMAT").hide();
                }
            }
        });
        //NGAYHETHIEULUC
        $("#NGAYHETHIEULUC").focusout(function () {
            if ($("#NGAYHETHIEULUC").val().trim().length > 0) {
                if (checkDateTime($("#NGAYHETHIEULUC").val()) == false) {
                    $("#NGAYHETHIEULUC_FORMAT").show();
                } else {
                    $("#NGAYHETHIEULUC_FORMAT").hide();
                }
            }
        });
        //DONVIBANHANH
        $("#DONVIBANHANH_ID").change(function () {
            TaoSoHieu();
        });
        //TRICHYEU
        $("#TRICHYEU").keyup(function () {
            var item = $("#TRICHYEU").val().trim().length;
            if (item <= 0) {
                $("#TRICHYEU_NULL").show();
            }
            else { $("#TRICHYEU_NULL").hide(); }
        });
        $("#btnSave").click(function () {
            //validate data
            //NHOMSOVANBAN_ID
            if (validate_element($("#NHOMSOVANBAN_ID"), $("#NHOMSOVANBAN_ID_NULL"), "", "", "0") == 0) {
                SelectTab(0);
                $("#NHOMSOVANBAN_ID").focus();
                return false;
            }
            //SOVANBAN_ID
            if (validate_element($("#SOVANBAN_ID"), $("#SOVANBAN_ID_NULL"), "", "", "0") == 0) {
                SelectTab(0);
                $("#SOVANBAN_ID").focus();
                return false;
            }
            //LOAIVANBAN_ID
            if (validate_element($("#LOAIVANBAN_ID"), $("#LOAIVANBAN_ID_NULL"), "", "", "0") == 0) {
                SelectTab(0);
                $("#LOAIVANBAN_ID").focus();
                return false;
            }
            //SODITONGHOP
            //if (validate_element($("#SODITONGHOP"), $("#SODITONGHOP_NULL"), "", "", "0") == 0) {
            //    SelectTab(0);
            //    $("#SODITONGHOP").focus();
            //    return false;
            //}
            //SODITHEOSO
            if (validate_element($("#SODITHEOSO"), $("#SODITHEOSO_NULL"), "", "", "0") == 0) {
                SelectTab(0);
                $("#SODITHEOSO").focus();
                return false;
            }
            //SOHIEUVANBAN
            if (validate_element($("#SOHIEU"), $("#SOHIEU_NULL"), "", "", "0") == 0) {
                SelectTab(0);
                $("#SOHIEU").focus();
                return false;
            }
            //NGAYKY
            if ($("#NGAYKY").val().trim().length > 0) {
                if (checkDateTime($("#NGAYKY").val()) == false) {
                    SelectTab(0);
                    $("#NGAYKY_FORMAT").show();
                    $("#NGAYKY").focus();
                    return false;
                }
                else {
                    $("#NGAYKY_FORMAT").hide();
                }
            }
            //NGAYBANHANH
            if ($("#NGAYBANHANH").val().trim().length > 0) {
                if (checkDateTime($("#NGAYBANHANH").val()) == false) {
                    SelectTab(0);
                    $("#NGAYBANHANH_FORMAT").show();
                    $("#NGAYBANHANH").focus();
                    return false;
                }
                else {
                    $("#NGAYBANHANH_FORMAT").hide();
                }
            }
            //TRICHYEU
            if (validate_element($("#TRICHYEU"), $("#TRICHYEU_NULL"), "", "", "0") == 0) {
                SelectTab(0);
                $("#TRICHYEU").focus();
                return false;
            }

            //SOBANSAO
            if ($("#SOBANSAO").val().trim().length > 0) {
                if ($.isNumeric($("#SOBANSAO").val()) == false) {
                    SelectTab(0);
                    $("#SOBANSAO_FORMAT").show();
                    $("#SOBANSAO").focus();
                    return false;
                }
                else {
                    $("#SOBANSAO_FORMAT").hide();
                }
            }
            //SOTO
            if ($("#SOTO").val().trim().length > 0) {
                if ($.isNumeric($("#SOTO").val()) == false) {
                    SelectTab(0);
                    $("#SOTO_FORMAT").show();
                    $("#SOTO").focus();
                    return false;
                }
                else {
                    $("#SOTO_FORMAT").hide();
                }
            }
            //NGAYCOHIEULUC
            if ($("#NGAYCOHIEULUC").val().trim().length > 0) {
                if (checkDateTime($("#NGAYCOHIEULUC").val()) == false) {
                    SelectTab(0);
                    $("#NGAYCOHIEULUC_FORMAT").show();
                    $("#NGAYCOHIEULUC").focus();
                    return false;
                }
                else {
                    $("#NGAYCOHIEULUC_FORMAT").hide();
                }
            }
            //NGAYHETHIEULUC
            if ($("#NGAYHETHIEULUC").val().trim().length > 0) {
                if (checkDateTime($("#NGAYHETHIEULUC").val()) == false) {
                    SelectTab(0);
                    $("#NGAYHETHIEULUC_FORMAT").show();
                    $("#NGAYHETHIEULUC").focus();
                    return false;
                }
                else {
                    $("#NGAYHETHIEULUC_FORMAT").hide();
                }
            }
            //NGUOISOAN
            if (validate_element($("#NGUOISOAN"), $("#NGUOISOAN_NULL"), "", "", "0") == 0) {
                SelectTab(0);
                return false;
            }
            //DONVISOAN
            if (validate_element($("#DONVISOANTHAO_ID"), $("#DONVISOAN_ID_NULL"), "", "", "0") == 0) {
                SelectTab(0);
                $("#DONVISOANTHAO_ID").focus();
                return false;
            }
            //submit form tao van ban di
            $("#frmVanBanDiCreate").submit();
        });
    });
    function SelectTab(tab_id) {
        var tab_current = $("li[aria-selected='true'] a").attr("id");
        var current_id = tab_current.split('-')[2];
        if (tab_id != current_id) {
            $("#vb_di_tabs-t-" + tab_id).click();
        }
    }
    function ThemNguoiKy() {
        var is_show = $("input[id='CHK_NHIEUNGUOIKY']:checked").length;
        if (is_show > 0) {
            $(".nhieunguoiky").show("slow");
        }
        else {
            $(".nhieunguoiky").hide();
        }
    }
    function TaoSoHieu() {
        //alert("Số hiệu văn bản được tạo ra từ 3 thông tin (Số văn bản, loại văn bản và đơn vị ban hành)!");
        var so_vanban = $("#SODITHEOSO").val();
        var loai_vanban = $("#LOAIVANBAN_ID option:selected").attr("data-id");
        var donvi_banhanh = $("#DONVIBANHANH_ID option:selected").attr("data-madv");
        var sohieu_vanban = "";
        if (so_vanban !== undefined) {
            sohieu_vanban += so_vanban + "/";
        }
        if (loai_vanban !== undefined) {
            sohieu_vanban += loai_vanban + "-";
        }
        if (donvi_banhanh !== undefined) {
            sohieu_vanban += donvi_banhanh;
        }
        $("#SOHIEU").val(sohieu_vanban);
    }

    function XoaNguoiKy(stt) {
        var hasValue = false;
        if (parseInt(stt) > 1) {
            hasValue = $("#NGUOIKYACCOUNT" + stt).val().length > 0;
        }
        else {
            hasValue = $("#NGUOIKYACCOUNT").val().length > 0;
        }
        if (hasValue) {
            $.confirm({
                'title': 'Xác nhận xóa',
                'message': 'Bạn có chắc chắn muốn xóa người ký này?',
                'buttons': {
                    'Xóa': {
                        'class': 'btn-confirm-yes',
                        'action': function () {
                            if (parseInt(stt) > 1) {
                                $("#NGUOIKYACCOUNT" + stt).val("");
                                $("#NGUOIKY" + stt).val("");
                            }
                            else {
                                $("#NGUOIKYACCOUNT").val("");
                                $("#NGUOIKY").val("");
                            }
                        }
                    },
                    'Không xóa': {
                        'class': 'btn-info',
                        'action': function () { }
                    }
                }
            });
        }
    }
    function XoaNguoiSoan() {
        var hasValue = $("#NGUOISOAN").val().length > 0;

        if (hasValue) {
            $.confirm({
                'title': 'Xác nhận xóa',
                'message': 'Bạn có chắc chắn muốn xóa người soạn này?',
                'buttons': {
                    'Xóa': {
                        'class': 'btn-confirm-yes',
                        'action': function () {
                            $("#NGUOISOAN").val("");
                            $("#NGUOISOAN_ID").val("");
                        }
                    },
                    'Không xóa': {
                        'class': 'btn-info',
                        'action': function () { }
                    }
                }
            });
        }
    }
    function LoadCoSo() {
        var capCoSoID = $("#CAPCOSO_ID").val();
        if (capCoSoID.length > 0) {
            $.ajax({
                type: 'GET',
                cache: false,
                async: false,
                data: { capCoSo: capCoSoID, list_coso_dachon: $("#COSO_NHANVB_IDS").val() },
                url: '@Url.Action("GetListCoSo", "VanBanDi")',
                success: function (data) {
                    $("#List_CoSo_NhanVB").html(data);
                }
            })
        }
        else {
            $("#List_CoSo_NhanVB").html("");
        }
    }
    function ChonCoSoNhanVanBan() {
        var list_coso_dachon = "";
        $("input[name='CHK_COSO']").each(function () {
            if ($(this).is(":checked")) {
                var coso = $(this).val();
                list_coso_dachon += coso + ",";
                var _html = $("#li_" + coso).find("label").html();
                var _capcoso = $("#li_" + coso).attr("data-cap-id");
                //Xóa bên trái
                $("#li_" + coso).remove();
                //Chèn bên phải
                $("#List_CoSo_NhanVB_DaChon").append("<li id='li_s_" + coso + "'>- <span>" + _html + "</span><img data-id='" + coso + "' id='img_" + coso + "' class='delete_coso' onclick='javascript:XoaCoSoDaChon(" + coso + ")' data-cap-id='" + _capcoso + "' style='cursor:pointer;margin-left:15px;' title='Bỏ cơ sở này' src='/Content/Images/Delete.png' /></li>");
            }
        });
        $("#COSO_NHANVB_IDS").val($("#COSO_NHANVB_IDS").val() + list_coso_dachon);
    }
    function XoaCoSoDaChon(coso_id) {
        var _capcoso = $("#img_" + coso_id).attr("data-cap-id");
        var tencoso = $("#li_s_" + coso_id).find("span").html();
        //Xóa bên phải, cập nhật lại List_ID
        $("#li_s_" + coso_id).remove();
        //Nếu cấp đang chọn chứa cơ sở bị xóa, thì phải hiển thị lại bên trái (thêm data-cap-id)
        if ($("#CAPCOSO_ID").val() == _capcoso) {
            var _li = "<li id='li_" + coso_id + "'>";
            _li += "<input class=\"css-checkbox\" id=\"CHK_" + coso_id + "\" value=\"" + coso_id + "\" name=\"CHK_COSO\" type=\"checkbox\">";
            _li += "<label style=\"width:auto;\" for=\"CHK_" + coso_id + "\" class=\"css-label2\">" + tencoso + "</label></li>";
            $("#List_CoSo_NhanVB ul").append(_li);
        }
        var list_coso_dachon = "";
        $(".delete_coso").each(function () {
            list_coso_dachon += $(this).attr("data-id") + ",";
        });
        $("#COSO_NHANVB_IDS").val(list_coso_dachon);
    }
</script>
@{
    #region Tạo model Người ký văn bản
    ChonNguoiDungModel nguoiky = new ChonNguoiDungModel();
    nguoiky.COSO_ID = Model.UserInfo.CoSoID.Value;
    nguoiky.DONVI_ID = 0;
    nguoiky.PHONGBAN_ID = 0;
    nguoiky.TEXT_ID = "NGUOIKYACCOUNT";
    nguoiky.VALUE_ID = "NGUOIKY";
    nguoiky.ID_CLICK = "CHONNGUOIKY";
    nguoiky.IS_MULTICHOICE = 0;
    nguoiky.INDEX = 1;
    nguoiky.TITLE = "Chọn người ký văn bản";
    nguoiky.SHOW_CHUC_VU_ID = "CHUCVU";
    //nguoiky.CALLBACK_FUNCTION = "";

    ChonNguoiDungModel nguoiky_2 = new ChonNguoiDungModel();
    nguoiky_2.COSO_ID = Model.UserInfo.CoSoID.Value;
    nguoiky_2.DONVI_ID = 0;
    nguoiky_2.PHONGBAN_ID = 0;
    nguoiky_2.TEXT_ID = "NGUOIKYACCOUNT2";
    nguoiky_2.VALUE_ID = "NGUOIKY2";
    nguoiky_2.ID_CLICK = "CHONNGUOIKY2";
    nguoiky_2.IS_MULTICHOICE = 0;
    nguoiky_2.INDEX = 2;
    nguoiky_2.TITLE = "Chọn người ký văn bản";
    nguoiky_2.SHOW_CHUC_VU_ID = "CHUCVU2";
    //nguoiky_2.CALLBACK_FUNCTION = "";

    ChonNguoiDungModel nguoiky_3 = new ChonNguoiDungModel();
    nguoiky_3.COSO_ID = Model.UserInfo.CoSoID.Value;
    nguoiky_3.DONVI_ID = 0;
    nguoiky_3.PHONGBAN_ID = 0;
    nguoiky_3.TEXT_ID = "NGUOIKYACCOUNT3";
    nguoiky_3.VALUE_ID = "NGUOIKY3";
    nguoiky_3.ID_CLICK = "CHONNGUOIKY3";
    nguoiky_3.IS_MULTICHOICE = 0;
    nguoiky_3.INDEX = 3;
    nguoiky_3.TITLE = "Chọn người ký văn bản";
    nguoiky_3.SHOW_CHUC_VU_ID = "CHUCVU3";
    //nguoiky_3.CALLBACK_FUNCTION = "";

    //ChonNguoiDungModel nguoiky_4 = new ChonNguoiDungModel();
    //nguoiky_4.COSO_ID = Model.UserInfo.CoSoID.Value;
    //nguoiky_4.DONVI_ID = 0;
    //nguoiky_4.PHONGBAN_ID = 0;
    //nguoiky_4.TEXT_ID = "NGUOIKYACCOUNT4";
    //nguoiky_4.VALUE_ID = "NGUOIKY4";
    //nguoiky_4.ID_CLICK = "CHONNGUOIKY4";
    //nguoiky_4.IS_MULTICHOICE = 0;
    //nguoiky_4.INDEX = 4;
    //nguoiky_4.TITLE = "Chọn người ký văn bản";
    //nguoiky_4.SHOW_CHUC_VU_ID = "CHUCVU4";
    ////nguoiky_4.CALLBACK_FUNCTION = "";

    //ChonNguoiDungModel nguoiky_5 = new ChonNguoiDungModel();
    //nguoiky_5.COSO_ID = Model.UserInfo.CoSoID.Value;
    //nguoiky_5.DONVI_ID = 0;
    //nguoiky_5.PHONGBAN_ID = 0;
    //nguoiky_5.TEXT_ID = "NGUOIKYACCOUNT5";
    //nguoiky_5.VALUE_ID = "NGUOIKY5";
    //nguoiky_5.ID_CLICK = "CHONNGUOIKY5";
    //nguoiky_5.IS_MULTICHOICE = 0;
    //nguoiky_5.INDEX = 5;
    //nguoiky_5.TITLE = "Chọn người ký văn bản";
    //nguoiky_5.SHOW_CHUC_VU_ID = "CHUCVU5";
    ////nguoiky_5.CALLBACK_FUNCTION = "";
    #endregion
}

@{ Html.RenderPartial("../Common/_ChooseUserV1", nguoiky);}
@{ Html.RenderPartial("../Common/_ChooseUserV1", nguoiky_2);}
@{ Html.RenderPartial("../Common/_ChooseUserV1", nguoiky_3);}
@*@{ Html.RenderPartial("../Common/_ChooseUserV1", nguoiky_4);}
    @{ Html.RenderPartial("../Common/_ChooseUserV1", nguoiky_5);}*@

@{
    ChonNguoiDungModel nguoisoan = new ChonNguoiDungModel();
    nguoisoan.COSO_ID = Model.UserInfo.CoSoID.Value;
    nguoisoan.DONVI_ID = 0;
    nguoisoan.PHONGBAN_ID = 0;
    nguoisoan.TEXT_ID = "NGUOISOAN";
    nguoisoan.VALUE_ID = "NGUOISOAN_ID";
    nguoisoan.ID_CLICK = "CHONNGUOISOAN";
    nguoisoan.IS_MULTICHOICE = 0;
    nguoisoan.INDEX = 6;
    nguoisoan.TITLE = "Chọn người soạn thảo văn bản";
    //nguoisoan.CALLBACK_FUNCTION = "";
}

@{ Html.RenderPartial("../Common/_ChooseUserV1", nguoisoan);}

