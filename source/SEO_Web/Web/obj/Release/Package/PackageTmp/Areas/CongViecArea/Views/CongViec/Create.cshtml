@using Web.Models
@using Web.Areas.CongViecArea.Models
@model CongViecViewModel
@{
    ViewBag.Title = "Smart DMS";
    Layout = "~/Views/Shared/_LayoutEmpty.cshtml";
    var task = Model.CongViec;
    var user = Model.UserInfo;
}

<div class="clearfix">
    <div class="jarviswidget" id="wid-id-0">
        <header role="heading">
            <h2 class="group-tittle mt10">Thêm mới công việc</h2>
        </header>
        <div role="content">
            <div class="widge-t-body no-padding">
                <div class="right-content clearfix">
                    @*<h3 class="group-tittle">
                        @if (!Model.IS_CONGVIEC_CANHAN)
                    {
                        @Html.Raw("Thông tin công việc")
                    }
                    else
                    {
                        @Html.Raw("Thông tin công việc cá nhân")
                    }
                        @if (Model.IS_LANHDAO_CUC && Model.IS_CONGVIEC_CANHAN == false)
                    {
                        <input class="css-checkbox" id="CHK_IS_GIAOVIECTHEOPHONG" value="@CongViecConstant.TASK_DONVI" name="LOAICONGVIEC" type="radio">
                        <label for="CHK_IS_GIAOVIECTHEOPHONG" class="css-label">
                            Giao cho đơn vị
                        </label><!--GIAO VIỆC CHO PHÒNG-->

                        <input class="css-checkbox" id="CHK_IS_GIAOVIECTHEOCANHAN" value="@CongViecConstant.TASK_NHANVIEN" name="LOAICONGVIEC" type="radio" checked="checked">
                        <label for="CHK_IS_GIAOVIECTHEOCANHAN" class="css-label">
                            Giao cho cá nhân
                        </label><!--GIAO VIỆC CHO CÁ NHÂN-->
                    }
                    </h3>*@
                    @using (Html.BeginForm("InsertCongViec", "CongViec", FormMethod.Post, new { enctype = "multipart/form-data", Id = "frmCongViecCreate" }))
                {
                    @Html.AntiForgeryToken()
                    <div id="block--form-insert">
                        <table class="edit-table">
                            @if (Model.IS_CONGVIEC_CHUYENTIEP)
                            {
                        <tr>
                            <td>
                                <label class="lbl" for="TEN_CONGVIEC_GOC">
                                    Tên công việc gốc :
                                </label>
                            </td>
                            <td colspan="3">
                                <span id="TEN_CONGVIEC_GOC">@task.TENCONGVIEC</span>
                            </td>
                        </tr>
                        <tr class="height-15">
                            <td colspan="4">
                                @Html.Hidden("CONGVIECGOC_ID", task.ID.ToString())
                            </td>
                        </tr>
                            }
                            @if (Model.IS_CONGVIEC_CANHAN == false)
                            {
                        <tr>
                            <td>
                                <label class="lbl" for="NGUOIGIAOVIEC">
                                    Người giao việc:<span class="red">*</span>
                                </label>
                            </td>
                            <td colspan="3">
                                <input type="text" name="NGUOIGIAOVIEC" id="NGUOIGIAOVIEC" placeholder="" class="e-input" value="@user.Fullname" maxlength="500" />
                                <a href="javascript:void(0)" id="CHONNGUOIGIAOVIEC">
                                    Chọn
                                </a>|<a href="javascript:XoaNguoiGiaoViec()" id="button--remove-deliver">
                                    Xóa
                                </a>
                                <input type="hidden" id="NGUOIGIAOVIEC_ID" name="NGUOIGIAOVIEC_ID" value="@user.UserID" />
                            </td>
                        </tr>
                        <tr class="height-15">
                            <td></td>
                            <td colspan="3">
                                <span class="lb-Check" id="NGUOIGIAOVIEC_ID_NULL">Bạn hãy chọn người giao việc</span>
                            </td>
                        </tr>
                            }
                            @if (Model.IS_LANHDAO_CUC && Model.IS_CONGVIEC_CANHAN == false)
                            {
                        <tr class="job-phong">
                            <td>
                                <label class="lbl" for="DONVIXULYCHINH">
                                    Đơn vị chủ trì:<span class="red">*</span>
                                </label>
                            </td>
                            <td colspan="3">
                                <input type="text" name="DONVIXULYCHINH" id="DONVIXULYCHINH" placeholder="" class="e-input" maxlength="500" autocomplete="off" />

                                <a class="link-select" href="javascript:void(0)" id="CHONDONVIXULYCHINH">Chọn</a>|<a class="link-remove" href="javascript:XoaDonViXuLyChinh()">Xóa</a>
                                <input type="hidden" id="DONVIXULYCHINHID" name="DONVIXULYCHINHID" />
                            </td>
                        </tr>
                        <tr class="job-phong height-15">
                            <td></td>
                            <td colspan="3">
                                <span class="lb-Check" id="DONVIXULYCHINHID_NULL">Bạn hãy chọn đơn vị chủ trì</span>
                            </td>
                        </tr>

                        <tr class="job-phong">
                            <td>
                                <label class="lbl" for="DONVITHAMGIAXULY">
                                    Đơn vị phối hợp
                                </label>
                            </td>
                            <td colspan="3">
                                <input type="text" name="DONVITHAMGIAXULY" id="DONVITHAMGIAXULY" placeholder="" class="e-input" maxlength="500" autocomplete="off" />
                                <a class="link-select" href="javascript:void(0)" id="CHONDONVITHAMGIAXULY">Chọn</a>|<a class="link-remove" href="javascript:XoaDonViThamGiaXuLy()">Xóa</a>
                                <input type="hidden" id="DONVITHAMGIAXULY_ID" name="DONVITHAMGIAXULY_ID" value="" />
                            </td>
                        </tr>
                        <tr class="job-phong height-15"></tr>

                        @*<tr class="job-phong">
                                <td>
                                    <label class="lbl" for="PHONGTHEODOI">Phòng theo dõi:</label>
                                </td>
                                <td colspan="3">
                                    <input type="text" name="PHONGTHEODOI" id="PHONGTHEODOI" placeholder="" class="e-input" maxlength="500" />
                                    <a class="link-select" href="javascript:void(0)" id="CHONPHONGTHEODOI">Chọn</a>|<a class="link-remove" href="javascript:XoaPhongTheoDoi()">Xóa</a>
                                    <input type="hidden" id="PHONGTHEODOI_ID" name="PHONGTHEODOI_ID" value="" />
                                </td>
                            </tr>
                            <tr class="job-phong height-15"></tr>*@
                            }
                            @if (Model.IS_CONGVIEC_CANHAN == false)
                            {
                        <tr class="job-canhan">
                            <td>
                                <label class="lbl" for="NGUOIXULYCHINH">
                                    Người xử lý chính:<span class="red">*</span>
                                </label>
                            </td>
                            <td colspan="3">
                                <input type="text" name="NGUOIXULYCHINH" id="NGUOIXULYCHINH" placeholder="" class="e-input" maxlength="500" />
                                <a href="javascript:void(0)" id="CHONNGUOIXULYCHINH">
                                    Chọn
                                </a>|<a href="javascript:XoaNguoiXuLyChinh()" id="button--remove-main-handler">
                                    Xóa
                                </a>
                                <input type="hidden" id="NGUOIXULYCHINH_ID" name="NGUOIXULYCHINH_ID" />
                                <input class="css-checkbox" id="CHK_HAS_ROLE_BOSUNGTHANHVIEN" checked="checked" value="True" name="CHK_HAS_ROLE_BOSUNGTHANHVIEN" type="checkbox">
                                <label for="CHK_HAS_ROLE_BOSUNGTHANHVIEN" class="css-label2">
                                    Được bổ sung thành viên
                                </label>

                                <input class="css-checkbox" id="CHK_HAS_ROLE_THAYDOITRANGTHAI" checked="checked" value="True" name="CHK_HAS_ROLE_THAYDOITRANGTHAI" type="checkbox">
                                <label for="CHK_HAS_ROLE_THAYDOITRANGTHAI" class="css-label2">
                                    Được thay đổi trạng thái
                                </label>
                            </td>
                        </tr>
                        <tr class="job-canhan height-15">
                            <td></td>
                            <td colspan="3">
                                <span class="lb-Check" id="NGUOIXULYCHINH_ID_NULL">Bạn hãy chọn người xử lý chính</span>
                            </td>
                        </tr>

                        <tr class="job-canhan">
                            <td>
                                <label class="lbl" for="NGUOITHEODOI">
                                    Người theo dõi:
                                </label>
                            </td>
                            <td colspan="3">
                                <input type="text" name="NGUOITHEODOI" id="NGUOITHEODOI" placeholder="" class="e-input" maxlength="500" />
                                <a href="javascript:void(0)" id="CHONNGUOITHEODOI">
                                    Chọn
                                </a>|<a href="javascript:XoaNguoiTheoDoi()" id="button--remove-follower">
                                    Xóa
                                </a>
                                <input type="hidden" id="NGUOITHEODOI_ID" name="NGUOITHEODOI_ID" value="" />

                                <input class="css-checkbox" id="CHK_HAS_ROLE_GHINOIDUNGCONGVIEC" checked="checked" value="True" name="CHK_HAS_ROLE_GHINOIDUNGCONGVIEC" type="checkbox">
                                <label for="CHK_HAS_ROLE_GHINOIDUNGCONGVIEC" class="css-label2">
                                    Được ghi nội dung công việc
                                </label>

                                <input class="css-checkbox" id="CHK_HAS_ROLE_THAYDOITRANGTHAI_NTD" value="True" name="CHK_HAS_ROLE_THAYDOITRANGTHAI_NTD" type="checkbox">
                                <label for="CHK_HAS_ROLE_THAYDOITRANGTHAI_NTD" class="css-label2">
                                    Được thay đổi trạng thái
                                </label>
                            </td>
                        </tr>
                        <tr class="job-canhan height-15"></tr>

                        <tr class="job-canhan">
                            <td>
                                <label class="lbl" for="NGUOITHAMGIAPHOIHOP">Người tham gia xử lý:</label>
                            </td>
                            <td colspan="3">
                                <input type="text" name="NGUOITHAMGIAPHOIHOP" id="NGUOITHAMGIAPHOIHOP" placeholder="" class="e-input" maxlength="500" />
                                <a class="link-select" href="javascript:void(0)" id="CHONNGUOITHAMGIAPHOIHOP">Chọn</a>|<a class="link-remove" href="javascript:XoaNguoiThamGiaXuLy()">Xóa</a>
                                <input type="hidden" id="NGUOITHAMGIAPHOIHOP_ID" name="NGUOITHAMGIAPHOIHOP_ID" value="" />
                            </td>
                        </tr>
                        <tr class="job-canhan height-15"></tr>
                            }
                            <tr>
                                <td>
                                    <label class="lbl" for="TENCONGVIEC">
                                        Tên công việc:<span class="red">*</span>
                                    </label>
                                </td>
                                <td colspan="3">
                                    <input type="text" name="TENCONGVIEC" id="TENCONGVIEC" placeholder="Tên công việc" class="e-input" maxlength="500" autocomplete="off" @(Model.IS_CONGVIEC_CANHAN ? "autofocus=autofocus" : string.Empty) />
                                </td>
                            </tr>
                            <tr class="height-15">
                                <td></td>
                                <td colspan="3">
                                    <span class="lb-Check" id="TENCONGVIEC_NULL">Bạn hãy nhập tên công việc</span>
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <label class="lbl" for="NGAYBATDAU">
                                        Ngày bắt đầu:<span class="red">*</span>
                                    </label>
                                </td>
                                <td class="width-250">
                                    <input type="text" name="NGAYBATDAU" id="NGAYBATDAU" class="e-input datepicker" maxlength="10" value="@string.Format("{0:dd/MM/yyyy}",DateTime.Now)" autocomplete="off" placeholder="Ngày bắt đầu" />
                                </td>
                                <td class="width-150">
                                    <label class="lbl" for="HANKETTHUC">
                                        Ngày kết thúc:<span class="red">*</span>
                                    </label>
                                </td>
                                <td>
                                    <input name="HANKETTHUC" id="HANKETTHUC" value="" class="e-input datepicker" maxlength="10"
                                           placeholder="Hạn kết thúc" autocomplete="off" />
                                </td>
                            </tr>
                            <tr class="height-15">
                                <td></td>
                                <td>
                                    <span class="lb-Check" id="NGAYBATDAU_ERROR">
                                    </span>
                                </td>
                                <td></td>
                                <td>
                                    <span class="lb-Check" id="HANKETTHUC_ERROR"></span>
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <label class="lbl" for="DOUUTIEN_ID">
                                        Độ ưu tiên:<span class="red">*</span>
                                    </label>
                                </td>
                                <td class="width-250">
                                    <div class="input-field4 clearfix float-left" id="block--select-douutien">
                                        @Html.DropDownList("DOUUTIEN_ID", Model.ListDoUuTien, new { @class = "create-phanloai width-100" })
                                    </div>
                                </td>
                                <td class="width-150">
                                    <label for="TRANGTHAI_ID" class="lbl">
                                        Trạng thái:<span class="red">*</span>
                                    </label>
                                </td>
                                <td>
                                    <div class="input-field4 clearfix float-left" id="block--select-trangthai">
                                        @Html.DropDownList("TRANGTHAI_ID", Model.ListTrangThai, new { @class = "create-phanloai width-100" })
                                    </div>
                                </td>
                            </tr>
                            <tr class="height-15"></tr>

                            <tr>
                                <td>
                                    <label class="lbl" for="NOIDUNGCONGVIEC">
                                        Nội dung công việc:<span class="red">*</span>
                                    </label>
                                </td>
                                <td colspan="3">
                                    <textarea id="NOIDUNGCONGVIEC" name="NOIDUNGCONGVIEC" placeholder="Nội dung công việc" class="e-input" maxlength="1500"></textarea>
                                </td>
                            </tr>
                            <tr class="height-15">
                                <td></td>
                                <td colspan="3">
                                    <span class="lb-Check" id="NOIDUNGCONGVIEC_NULL">Bạn hãy nhập nội dung công việc</span>
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <label class="lbl">Tài liệu đính kèm:</label>
                                </td>
                                <td colspan="3">
                                    <div id="block--tailieu-dinhkem">
                                        @{Html.RenderPartial("../Common/UploadFile", new List<Model.eAita.TAILIEUDINHKEM>());}
                                    </div>
                                </td>
                            </tr>
                            <tr class="height-15"></tr>

                            @if (Model.HasCongVan)
                            {
                                if (Model.ListTaiLieuDinhKem != null && Model.ListTaiLieuDinhKem.Count > 0)
                                {
                        <tr>
                            <td>
                                <label class="lbl">Tài liệu của Công văn:</label>
                            </td>
                            <td colspan="3">
                                <div id="block--tailieu-dinhkem-congvan">
                                    @{Html.RenderPartial("../Common/UploadFile", Model.ListTaiLieuDinhKem, new ViewDataDictionary { { "detail", 1 } });}
                                </div>
                            </td>
                        </tr>
                        <tr class="height-15"></tr>
                        <tr>
                            <td>
                                <label class="lbl">Phân phát công văn:</label>
                            </td>
                            <td colspan="3">
                                @if (Model.ListTaiLieuDinhKem != null && Model.ListTaiLieuDinhKem.Count > 0)
                                            {
                                    <input class="css-checkbox" id="CHK_IS_DINHKEMTAILIEUVANBAN" checked="checked" value="True" name="CHK_IS_DINHKEMTAILIEUVANBAN" type="checkbox">
                                    <label style="width:auto;" for="CHK_IS_DINHKEMTAILIEUVANBAN" class="css-label2">
                                        Đính kèm tài liệu của Công văn vào công việc
                                    </label>
                                            }
                                @if (Model.IS_CONGVIEC_CANHAN == false)
                                            {
                                    <input class="css-checkbox" id="CHK_IS_PHANPHATCONGVANCHONGUOITHAMGIAXULY" value="True" name="CHK_IS_PHANPHATCONGVANCHONGUOITHAMGIAXULY" type="checkbox">
                                    <label style="width:auto;" for="CHK_IS_PHANPHATCONGVANCHONGUOITHAMGIAXULY" class="css-label2">
                                        Phân phát công văn cho cán bộ tham gia xử lý công việc
                                    </label>
                                            }
                            </td>

                        </tr>
                        <tr class="height-15"></tr>
                                }
                            }
                            <tr id="row--get-alert-method">
                                <td>
                                    <label class="lbl">Nhận thông báo:</label>
                                </td>
                                <td colspan="3">
                                    <input class="css-checkbox" id="CHK_IS_POPUP" checked="checked" value="True" name="CHK_IS_POPUP" type="checkbox">
                                    <label for="CHK_IS_POPUP" class="css-label2">
                                        Tin thông báo
                                    </label>

                                    <input class="css-checkbox" id="CHK_IS_MESG" value="True" name="CHK_IS_MESG" type="checkbox">
                                    <label for="CHK_IS_MESG" class="css-label2">
                                        Tin nhắn
                                    </label>

                                    <input class="css-checkbox" id="CHK_IS_EMAIL" value="True" name="CHK_IS_EMAIL" type="checkbox">
                                    <label for="CHK_IS_EMAIL" class="css-label2">
                                        Email
                                    </label>
                                    @if (!Model.IS_CONGVIEC_CANHAN)
                                    {
                                <input class="css-checkbox" id="CHK_IS_SMS" value="True" name="CHK_IS_SMS" type="checkbox">
                                <label for="CHK_IS_SMS" class="css-label2">
                                    SMS
                                </label>
                                    }
                                </td>
                            </tr>
                            <tr class="height-15"></tr>
                            <tr>
                                <td>
                                    <label class="lbl" for="CHK_HAS_NHACVIECDENHAN">
                                        Nhắc việc đến hạn:
                                    </label>
                                </td>
                                <td colspan="3">
                                    <input class="css-checkbox" id="CHK_HAS_NHACVIECDENHAN" value="True" name="CHK_HAS_NHACVIECDENHAN" type="checkbox">
                                    <label for="CHK_HAS_NHACVIECDENHAN" class="css-label2">
                                        Gửi tin nhắn nhắc việc đến hạn <b>trước</b>
                                    </label>
                                    <input maxlength="3" type="text" value="1" name="SONGAYNHACTRUOCHAN" id="SONGAYNHACTRUOCHAN" /> (ngày)
                                </td>
                            </tr>
                            <tr class="height-15">
                                <td></td>
                                <td colspan="3">
                                    <span class="lb-Check" id="SONGAYNHACTRUOCHAN_ERROR"></span>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div id="block--form-button-container">
                        @if (Model.IS_CONGVIEC_CANHAN)
                        {
                    <input type="hidden" value="@CongViecConstant.TASK_CANHAN" name="ISVIECCANHAN">
                        }
                        else
                        {
                    <input type="hidden" id="LOAICONGVIEC" name="LOAICONGVIEC" value="@CongViecConstant.TASK_NHANVIEN" />
                        }
                        <input type="hidden" id="VBTYPE" value="@ViewBag.VBTYPE" name="VBTYPE" />
                        <input type="hidden" id="VBID" value="@ViewBag.VBID" name="VBID" />
                        <input type="submit" value="@(Model.IS_CONGVIEC_CANHAN ? "Lưu công việc" : "Giao công việc")" id="btnSave" />
                        <input type="button" value="Hủy bỏ" onclick="cancel()" id="button--close-insert-task" />
                    </div>
                }
                </div>
            </div>
        </div>
    </div>
</div>

@{
    LuaChonThuMucModel model_chonthumuc = new LuaChonThuMucModel();
    model_chonthumuc.USER_ID = (long)Model.UserInfo.UserID;
    model_chonthumuc.TITLE = "Lựa chọn thư mục để lưu file";
    model_chonthumuc.ID_CLICK = "ChooseFile";
    model_chonthumuc.DONVI_ID = Model.UserInfo.DonViID;
    model_chonthumuc.COSO_ID = Model.UserInfo.CoSoID;
}
@{ Html.RenderPartial("../Common/_LuaChonThuMuc", model_chonthumuc);}

@{
    #region Tạo model chọn user
    ChonNguoiDungModel NGUOIGIAOVIEC = new ChonNguoiDungModel();
    NGUOIGIAOVIEC.COSO_ID = Model.UserInfo.CoSoID.Value;
    NGUOIGIAOVIEC.DONVI_ID = Model.IS_LANHDAO_CUC ? 0 : Model.UserInfo.DonViID;
    NGUOIGIAOVIEC.PHONGBAN_ID = 0;
    NGUOIGIAOVIEC.TEXT_ID = "NGUOIGIAOVIEC";
    NGUOIGIAOVIEC.VALUE_ID = "NGUOIGIAOVIEC_ID";
    NGUOIGIAOVIEC.ID_CLICK = "CHONNGUOIGIAOVIEC";
    NGUOIGIAOVIEC.IS_MULTICHOICE = 0;
    NGUOIGIAOVIEC.INDEX = 1;
    NGUOIGIAOVIEC.TITLE = "Chọn người giao việc";
    NGUOIGIAOVIEC.CALLBACK_FUNCTION = "ValidateNguoiGiaoViec";
    Html.RenderPartial("../Common/_ChooseUserV1", NGUOIGIAOVIEC);
    #endregion

    ChonNguoiDungModel NGUOIXULYCHINH = new ChonNguoiDungModel();
    NGUOIXULYCHINH.COSO_ID = Model.UserInfo.CoSoID.Value;
    NGUOIXULYCHINH.DONVI_ID = Model.IS_LANHDAO_CUC ? 0 : Model.UserInfo.DonViID;
    NGUOIXULYCHINH.PHONGBAN_ID = 0;
    NGUOIXULYCHINH.TEXT_ID = "NGUOIXULYCHINH";
    NGUOIXULYCHINH.VALUE_ID = "NGUOIXULYCHINH_ID";
    NGUOIXULYCHINH.ID_CLICK = "CHONNGUOIXULYCHINH";
    NGUOIXULYCHINH.IS_MULTICHOICE = 1;
    NGUOIXULYCHINH.INDEX = 2;
    NGUOIXULYCHINH.TITLE = "Chọn người xử lý chính";
    NGUOIXULYCHINH.CALLBACK_FUNCTION = "ValidateNguoiXuLyChinh";
    Html.RenderPartial("../Common/_ChooseUserV1", NGUOIXULYCHINH);

    ChonNguoiDungModel NGUOITHAMGIAPHOIHOP = new ChonNguoiDungModel();
    NGUOITHAMGIAPHOIHOP.COSO_ID = Model.UserInfo.CoSoID.Value;
    NGUOITHAMGIAPHOIHOP.DONVI_ID = Model.IS_LANHDAO_CUC ? 0 : Model.UserInfo.DonViID;
    NGUOITHAMGIAPHOIHOP.PHONGBAN_ID = 0;
    NGUOITHAMGIAPHOIHOP.TEXT_ID = "NGUOITHAMGIAPHOIHOP";
    NGUOITHAMGIAPHOIHOP.VALUE_ID = "NGUOITHAMGIAPHOIHOP_ID";
    NGUOITHAMGIAPHOIHOP.ID_CLICK = "CHONNGUOITHAMGIAPHOIHOP";
    NGUOITHAMGIAPHOIHOP.IS_MULTICHOICE = 1;
    NGUOITHAMGIAPHOIHOP.INDEX = 3;
    NGUOITHAMGIAPHOIHOP.TITLE = "Chọn người tham gia phối hợp xử lý";
    Html.RenderPartial("../Common/_ChooseUserV1", NGUOITHAMGIAPHOIHOP);

    ChonNguoiDungModel NGUOITHEODOI = new ChonNguoiDungModel();
    NGUOITHEODOI.COSO_ID = Model.UserInfo.CoSoID.Value;
    NGUOITHEODOI.DONVI_ID = Model.IS_LANHDAO_CUC ? 0 : Model.UserInfo.DonViID;
    NGUOITHEODOI.PHONGBAN_ID = 0;
    NGUOITHEODOI.TEXT_ID = "NGUOITHEODOI";
    NGUOITHEODOI.VALUE_ID = "NGUOITHEODOI_ID";
    NGUOITHEODOI.ID_CLICK = "CHONNGUOITHEODOI";
    NGUOITHEODOI.IS_MULTICHOICE = 1;
    NGUOITHEODOI.INDEX = 4;
    NGUOITHEODOI.TITLE = "Chọn người theo dõi công việc";
    Html.RenderPartial("../Common/_ChooseUserV1", NGUOITHEODOI);


    //Chọn đơn vị xử lý chính
    ChonNguoiDungModel DonViChuTri = new ChonNguoiDungModel();
    DonViChuTri.COSO_ID = Model.UserInfo.CoSoID.Value;
    DonViChuTri.TEXT_ID = "DONVIXULYCHINH";
    DonViChuTri.VALUE_ID = "DONVIXULYCHINHID";
    DonViChuTri.ID_CLICK = "CHONDONVIXULYCHINH";
    DonViChuTri.IS_MULTICHOICE = 1;
    DonViChuTri.INDEX = 1;
    DonViChuTri.TITLE = "Chọn đơn vị chủ trì";
    DonViChuTri.CALLBACK_FUNCTION = "ValidateDonViXuLyChinh";
    Html.RenderPartial("../Common/_ChooseDonViV1", DonViChuTri);

    //chọn đơn vị tham gia xử lý
    ChonNguoiDungModel DonViThamGiaXuLy = new ChonNguoiDungModel();
    DonViThamGiaXuLy.COSO_ID = Model.UserInfo.CoSoID.Value;
    DonViThamGiaXuLy.TEXT_ID = "DONVITHAMGIAXULY";
    DonViThamGiaXuLy.VALUE_ID = "DONVITHAMGIAXULY_ID";
    DonViThamGiaXuLy.ID_CLICK = "CHONDONVITHAMGIAXULY";
    DonViThamGiaXuLy.IS_MULTICHOICE = 1;
    DonViThamGiaXuLy.INDEX = 2;
    DonViThamGiaXuLy.TITLE = "Chọn đơn vị phối hợp";
    Html.RenderPartial("../Common/_ChooseDonViV1", DonViThamGiaXuLy);
}

<script type="text/javascript">
    var $emptyStr = "";
    $(document).ready(function () {
        $(".datepicker").datepicker({
            dateFormat: 'dd/mm/yy',
            changeMonth: true,
            changeYear: true,
            yearRange: "-50:+20"
        });
        //tinymce.init({
        //    selector: '#NOIDUNGCONGVIEC',
        //    language: 'vi_VN',
        //    width: 750,
        //    height: 100,
        //    plugins: [
        //            "advlist autolink autosave link image lists charmap print preview hr anchor pagebreak spellchecker",
        //            "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking",
        //            "table contextmenu directionality emoticons template textcolor paste textcolor colorpicker textpattern"
        //    ],
        //    toolbar1: "bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | styleselect formatselect fontselect fontsizeselect",
        //    toolbar2: "cut copy paste pastetext | bullist numlist | outdent indent | undo redo | link unlink code | forecolor backcolor",
        //    toolbar3: "table | hr removeformat | subscript superscript | charmap emoticons | insertdatetime preview | print fullscreen | ltr rtl | pagebreak restoredraft",
        //    menubar: true,
        //    convert_urls: false,
        //    paste_data_images: true,
        //    toolbar_items_size: 'small'
        //});
        $('input[name=LOAICONGVIEC]').on('change', function () {
            if ($(this).val() === '@CongViecConstant.TASK_DONVI') {
                $('.job-phong').show('slow');
                $('.job-canhan').hide();
                $('#LOAICONGVIEC').val($(this).val());
            } else if ($(this).val() === '@CongViecConstant.TASK_NHANVIEN') {
                $('.job-canhan').show('slow');
                $('.job-phong').hide();
                $('#LOAICONGVIEC').val($(this).val());
            }
        });
        //$('#DOUUTIEN_ID').multipleSelect({
        //    single: true
        //});
        //$('#TRANGTHAI_ID').multipleSelect({
        //    single: true
        //});
        //setting TENCONGVIEC
        $('#TENCONGVIEC').on('keyup', function () {
            if (this.value.trim() === $emptyStr) {
                $('#TENCONGVIEC_NULL').show();
            } else {
                $('#TENCONGVIEC_NULL').hide();
            }
        });
        //setting NGAYBATDAU
        $('#NGAYBATDAU').on('keyup change', function () {
            if (this.value.trim() === $emptyStr) {
                document.getElementById('NGAYBATDAU_ERROR').innerHTML = 'Bạn hãy nhập ngày bắt đầu';
                $('#NGAYBATDAU_ERROR').show();
            } else {
                $('#NGAYBATDAU_ERROR').hide();
            }
        });

        //setting NGAYKETTHUC
        $('#HANKETTHUC').on('keyup change', function () {
            if (this.value.trim() === $emptyStr) {
                document.getElementById('HANKETTHUC_ERROR').innerHTML = 'Bạn hãy nhập hạn kết thúc'
                $('#HANKETTHUC_ERROR').show();
            } else {
                $('#HANKETTHUC_ERROR').hide();
            }
        });

        $("#btnSave").click(function () {
            //Kiểm tra dữ liệu

            //NGUOIGIAOVIEC
            if ($('#NGUOIGIAOVIEC').length > 0) {
                if (validate_element($("#NGUOIGIAOVIEC"), $("#NGUOIGIAOVIEC_ID_NULL"), "", "", "0") == 0) {
                    $("#NGUOIGIAOVIEC").focus();
                    return false;
                }
            }
            //LOAICONGVIEC
            if ($('input[type=radio][name=LOAICONGVIEC]').length > 0) {
                var type = $('input[type=radio][name=LOAICONGVIEC]:checked').val();
                if (type === '@CongViecConstant.TASK_NHANVIEN') {
                    //NGUOIXULYCHINH
                    if (validate_element($("#NGUOIXULYCHINH"), $("#NGUOIXULYCHINH_ID_NULL"), "", "", "0") == 0) {
                        $("#NGUOIXULYCHINH").focus();
                        return false;
                    }
                } else {
                    //PHONGXULYCHINH
                    if (validate_element($("#DONVIXULYCHINH"), $("#DONVIXULYCHINHID_NULL"), "", "", "0") == 0) {
                        $("#DONVIXULYCHINH").focus();
                        return false;
                    }
                }
            }
            //TENCONGVIEC
            if (validate_element($("#TENCONGVIEC"), $("#TENCONGVIEC_NULL"), "", "", "0") == 0) {
                $("#TENCONGVIEC").focus();
                return false;
            }
            //NGAYBATDAU
            var strNgayBatDau = $('#NGAYBATDAU').val().trim();
            if (strNgayBatDau === $emptyStr) {
                document.getElementById('NGAYBATDAU_ERROR').innerHTML = 'Bạn hãy nhập ngày bắt đầu';
                $('#NGAYBATDAU').focus();
                $('#NGAYBATDAU_ERROR').show();
                return false;
            } else {
                if (checkDateTime(strNgayBatDau) === false) {
                    document.getElementById('NGAYBATDAU_ERROR').innerHTML = 'Bạn hãy nhập đúng định dạng';
                    $('#NGAYBATDAU').focus();
                    $('#NGAYBATDAU_ERROR').show();
                    return false;
                } else {
                    $('#NGAYBATDAU_ERROR').hide();
                }
            }

            //HANKETTHUC
            var strHanKetThuc = $('#HANKETTHUC').val().trim();
            if (strHanKetThuc === $emptyStr) {
                document.getElementById('HANKETTHUC_ERROR').innerHTML = 'Bạn hãy nhập hạn kết thúc';
                $('#HANKETTHUC').focus();
                $('#HANKETTHUC_ERROR').show();
                return false;
            } else {
                if (checkDateTime(strHanKetThuc) === false) {
                    document.getElementById('HANKETTHUC_ERROR').innerHTML = 'Bạn hãy nhập đúng định dạng';
                    $('#HANKETTHUC').focus();
                    $('#HANKETTHUC_ERROR').show();
                    return false;
                } else {
                    $('#HANKETTHUC_ERROR').hide();
                }
            }

            //SONGAYBAOTRUOCHAN
            if ($("#CHK_HAS_NHACVIECDENHAN:checked").val() != undefined) {
                if ($("#CHK_HAS_NHACVIECDENHAN:checked").val().trim().length > 0) {
                    var strSoNgay = $('#SONGAYNHACTRUOCHAN').val().trim();
                    if (strSoNgay === $emptyStr) {
                        document.getElementById('SONGAYNHACTRUOCHAN_ERROR').innerHTML = 'Bạn hãy nhập số ngày';
                        $('#SONGAYNHACTRUOCHAN_ERROR').show();
                        return false;
                    } else {
                        if ($.isNumeric(strSoNgay) === false) {
                            document.getElementById('SONGAYNHACTRUOCHAN_ERROR').innerHTML = 'Bạn hãy nhập định dạng số (ví dụ: 1 hoặc 2)';
                            $('#SONGAYNHACTRUOCHAN_ERROR').show();
                            return false;
                        } else {
                            if (parseInt(strSoNgay) < 0) {
                                document.getElementById('SONGAYNHACTRUOCHAN_ERROR').innerHTML = 'Số ngày phải lớn hơn 0';
                                $('#SONGAYNHACTRUOCHAN_ERROR').show();
                                return false;
                            }
                        }
                        $('#SONGAYNHACTRUOCHAN_ERROR').hide();
                    }
                }
            }
            var noidungcv = tinyMCE.get('NOIDUNGCONGVIEC').getContent();
            //NOIDUNGCONGVIEC
            if (noidungcv.trim().length <= 0) {
                $("#NOIDUNGCONGVIEC_NULL").show();
                $("#NOIDUNGCONGVIEC").focus();
                return false;
            }
            else {
                $("#NOIDUNGCONGVIEC_NULL").hide();
            }
        });
    });
    function ValidateNguoiGiaoViec() {
        if (validate_element($("#NGUOIGIAOVIEC"), $("#NGUOIGIAOVIEC_ID_NULL"), "", "", "0") == 0) {
            $("#NGUOIGIAOVIEC").focus();
        }
    }
    function ValidateNguoiXuLyChinh() {
        if (validate_element($("#NGUOIXULYCHINH"), $("#NGUOIXULYCHINH_ID_NULL"), "", "", "0") == 0) {
            $("#NGUOIXULYCHINH").focus();
        }
    }
    function ValidateDonViXuLyChinh() {
        if (validate_element($("#DONVIXULYCHINH"), $("#DONVIXULYCHINHID_NULL"), "", "", "0") == 0) {
            $("#DONVIXULYCHINH").focus();
        }
    }

    function XoaNguoiGiaoViec() {
        var hasValue = $("#NGUOIGIAOVIEC").val().length > 0;

        if (hasValue) {
            $.confirm({
                'title': 'Xác nhận xóa',
                'message': 'Bạn có chắc chắn muốn xóa thông tin người giao việc?',
                'buttons': {
                    'Xóa': {
                        'class': 'btn-confirm-yes',
                        'action': function () {
                            $("#NGUOIGIAOVIEC").val("");
                            $("#NGUOIGIAOVIEC_ID").val("");
                        }
                    },
                    'Không xóa': {
                        'class': 'btn-info',
                        'action': function () { }
                    }
                }
            });
        }
    }
    function XoaNguoiXuLyChinh() {
        var hasValue = $("#NGUOIXULYCHINH").val().length > 0;
        if (hasValue) {
            $.confirm({
                'title': 'Xác nhận xóa',
                'message': 'Bạn có chắc chắn muốn xóa thông tin người xử lý chính?',
                'buttons': {
                    'Xóa': {
                        'class': 'btn-confirm-yes',
                        'action': function () {
                            $("#NGUOIXULYCHINH").val("");
                            $("#NGUOIXULYCHINH_ID").val("");
                        }
                    },
                    'Không xóa': {
                        'class': 'btn-info',
                        'action': function () { }
                    }
                }
            });
        }
    }
    function XoaNguoiThamGiaXuLy() {
        var hasValue = $("#NGUOITHAMGIAPHOIHOP").val().length > 0;
        if (hasValue) {
            $.confirm({
                'title': 'Xác nhận xóa',
                'message': 'Bạn có chắc chắn muốn xóa thông tin người tham gia xử lý?',
                'buttons': {
                    'Xóa': {
                        'class': 'btn-confirm-yes',
                        'action': function () {
                            $("#NGUOITHAMGIAPHOIHOP").val("");
                            $("#NGUOITHAMGIAPHOIHOP_ID").val("");
                        }
                    },
                    'Không xóa': {
                        'class': 'btn-info',
                        'action': function () { }
                    }
                }
            });
        }
    }
    function XoaNguoiTheoDoi() {
        var hasValue = $("#NGUOITHEODOI").val().length > 0;

        if (hasValue) {
            $.confirm({
                'title': 'Xác nhận xóa',
                'message': 'Bạn có chắc chắn muốn xóa thông tin người theo dõi?',
                'buttons': {
                    'Xóa': {
                        'class': 'btn-confirm-yes',
                        'action': function () {
                            $("#NGUOITHEODOI").val("");
                            $("#NGUOITHEODOI_ID").val("");
                        }
                    },
                    'Không xóa': {
                        'class': 'btn-info',
                        'action': function () { }
                    }
                }
            });
        }
    }

    function XoaDonViXuLyChinh() {
        var hasValue = $("#DONVIXULYCHINH").val().length > 0;

        if (hasValue) {
            $.confirm({
                'title': 'Xác nhận xóa',
                'message': 'Bạn có chắc chắn muốn xóa thông tin đơn vị chủ trì ?',
                'buttons': {
                    'Xóa': {
                        'class': 'btn-confirm-yes',
                        'action': function () {
                            $("#DONVIXULYCHINH").val("");
                            $("#DONVIXULYCHINH_ID").val("");
                        }
                    },
                    'Không xóa': {
                        'class': 'btn-info',
                        'action': function () { }
                    }
                }
            });
        }
    }
    function XoaDonViThamGiaXuLy() {
        var hasValue = $("#DONVITHAMGIAXULY").val().length > 0;

        if (hasValue) {
            $.confirm({
                'title': 'Xác nhận xóa',
                'message': 'Bạn có chắc chắn muốn xóa thông tin đơn vị phối hợp ?',
                'buttons': {
                    'Xóa': {
                        'class': 'btn-confirm-yes',
                        'action': function () {
                            $("#DONVITHAMGIAXULY").val("");
                            $("#DONVITHAMGIAXULY_ID").val("");
                        }
                    },
                    'Không xóa': {
                        'class': 'btn-info',
                        'action': function () { }
                    }
                }
            });
        }
    }
    function XoaPhongTheoDoi() {
        var hasValue = $("#PHONGTHEODOI").val().length > 0;

        if (hasValue) {
            $.confirm({
                'title': 'Xác nhận xóa',
                'message': 'Bạn có chắc chắn muốn xóa thông tin Phòng theo dõi?',
                'buttons': {
                    'Xóa': {
                        'class': 'btn-confirm-yes',
                        'action': function () {
                            $("#PHONGTHEODOI").val("");
                            $("#PHONGTHEODOI_ID").val("");
                        }
                    },
                    'Không xóa': {
                        'class': 'btn-info',
                        'action': function () { }
                    }
                }
            });
        }
    }

    function cancel() {
        location.href = '@Url.Action("Index")';
    }
</script>
<script>

    pageSetUp();
</script>



